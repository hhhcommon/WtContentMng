<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
  <meta http-equiv="expires" content="0">
	<title>平台映射</title>
	<meta name="keywords" content="我听,我享听">
  <meta name="description" content="我听,我享听">
  <link href="../resources/plugins/hplus/css/bootstrap.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/animate.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/style.min.css" rel="stylesheet">
  <link href="../resources/plugins/zTree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet"/>
  <link href="../resources/plugins/hplus/css/plugins/jqpagination/fy.css" rel="stylesheet"/>
  <script src="../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
  <script src="../resources/plugins/zTree/js/jquery.ztree.core-3.5.js"></script>
  <script src="../resources/plugins/zTree/js/jquery.ztree.excheck-3.5.js"></script>
  <script src="../resources/plugins/zTree/js/jquery.ztree.exedit-3.5.js"></script>
  <script src="../resources/plugins/hplus/js/bootstrap.min.js"></script>
  <script src="../resources/plugins/hplus/js/content.min.js"></script>
  <script src="../resources/js/context.utils.js"></script>
  <script src="../resources/js/common.utils.js"></script> 
</head>
<style>
*{margin：0;padding:0} 
ul,li{list-style: none;}
body{overflow: hidden;height:100%;}
.fl{float: left;}
.dis{display: none;}
.wrapper{
  position: relative;
  width:100%;
  height:545px;
  border:1px solid red;
}
.toobarArea{
  height:30px;
  width:200px;
  line-height:30px;
  margin: 10px auto;
  position: relative;
  overflow: hidden;
}
.toobarArea button{
  width: 60px;
  height: 24px;
  background: #0077c7;
  color: white;
  text-align: center;
  padding: 2px;
  font-size: 12px;
  border-radius: 20px;
}
.mainContent{
  width:100%;
  height:495px;
  position: relative;
  border: 1px solid red;
}
.tab_nav{
  width:100%;
  height:30px;
  line-height:30px;
  font-weight: bold;
  overflow: hidden;
  color:#000;
}
.tab_nav div{
  width:50%;
  height:100%;
  text-align: center;
  cursor: pointer;
}
.active{
  color:#0077c7;
  background:rgba(221,221,221,0.4);
}
.tav_con{
  width:100%;
  height:460px;
  padding:10px;
  overflow: auto;
  background:rgba(221,221,221,0.4);
}
.tavcon{
  width:100%;
  height:100%;
  min-width:1000px;
  overflow: hidden;
  position: relative;
}
.left{
  width:300px;
  height:395px;
  overflow-y: auto;
  border:1px solid #000;
}
.right_con{
  width:500px;
  height:395px;
  margin-left:40px;
  overflow-y: auto;
  border:1px solid #000;
}
.right_con h4{
  text-align: center;
}
.ri_li{
  width:100%;
  height:30px;
  padding:4px 4px;
  overflow: hidden;
}
.ri_li_span{
  float: left;
  margin:1px 1px 0px;
}
.ml{
  margin:1px 2px 0px 8px;
}
.mask{
  width:100%;
  height: 100%;
  position: fixed;
  top:0;
  left:0;
  background:rgba(0,0,0,0.5);
}
.wrapper_mask{
  width:80%;
  height:500px;
  min-width:480px;
  background: #fff;
  position: relative;
  margin:10px auto;
  padding:5px;
}
.modal_header{
  height:30px;
  line-height:100%;
  border-bottom:2px solid #dedede;
}
.modal_container{
  padding:5px;
  /*border:1px solid red;*/
}
.modalTree{
  width:300px;
  height:300px;
  border:1px solid red;
}
.list{
  margin-top:10px;
}
.modal_footer{
  overflow: hidden;
}
.save_btn{
  float: right;
  margin-right: 40px;
  background:#0077c7;
  color: #fff;
  border:none;
  padding:4px;
  border-radius:4px;
}
.newmap{
  width:auto;
  padding:0;
}
</style>
<body>
<div class="wrapper">
  <div class="toobarArea">
    <button type="button" id="add" opeType="claAdd" class="btn" style="margin-right:3px;">添加</button>
    <button type="button" id="mod" opeType="claMod" class="btn" style="margin-right:3px;">修改</button>
    <button type="button" id="del" opeType="claDel" class="btn" style="margin-right:3px;">删除</button>
  </div>
  <div class="mainContent">
    <div class="tab_nav">
      <div class="active fl">我听平台</div>
      <div class="fl">其他平台</div>
    </div>
    <div class="tav_con">
      <div class="tavcon wt">
        <ul class="left fl ztree" id="woting_tree"></ul>
        <div class="right_con fl">
          <h4>我听对应其他平台的分类关系</h4>
          <ul class="right">
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[电影电视]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【喜马拉雅】</span>
              <span class="ri_li_span fl">[电影电视]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[科技]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【喜马拉雅】</span>
              <span class="ri_li_span fl">[科技教育]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[音乐]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【荔枝】</span>
              <span class="ri_li_span fl">[音乐生活]</span>
            </li>
          </ul>
        </div>
      </div>
      <div class="tavcon dis other">
        <ul class="left fl ztree" id="other_tree"></ul>
        <div class="right_con fl">
          <h4>其他平台与我听的对应关系</h4>
          <ul class="right">
            <li class="ri_li">
              <input type="radio" class="check ri_li_span" />
              <span class="ri_li_span fl">【我听】</span>
              <span class="ri_li_span fl">[电影电视]</span>
              <span class="ri_li_span fl ml">对应</span>
              <span class="ri_li_span fl">【喜马拉雅】</span>
              <span class="ri_li_span fl">[电影电视]</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="mask">
  <div class="wrapper_mask">
    <div class="modal_header">
      <button type="button" class="close" id="close" data-dismiss="modal">
        <span aria-hidden="true">&times;</span>
        <span class="sr-only">Close</span>
      </button>
      <h4 class="modal_title">添加对应关系</h4>
    </div>
    <div class="modal_container">
      <p>你已经选择了【我听平台】[电影电视]</p>
      <p>请选择其他平台的栏目添加对应关系</p>
      <div class="ztree modalTree">
      
      </div>
      <div class="list">
        <div class="fl">即将添加映射关系是：</div>
        <div class="ri_li newmap">
          <span class="ri_li_span fl">【我听】</span>
          <span class="ri_li_span fl">[电影电视]</span>
          <span class="ri_li_span fl ml">对应</span>
          <span class="ri_li_span fl">【喜马拉雅】</span>
          <span class="ri_li_span fl">[电影电视]</span>
        </div>
      </div>
    </div>
    <div class="modal_footer">
      <button class="save_btn">保存</button>
    </div>
  </div>
</div>
</body>
<script>
$(function(){
  var wtObj,otherObj;
  var rootPath=getRootPath();

  //tab切换
  $(".tab_nav div").on("click",function(){
    $(".tab_nav div").removeClass("active"); 
    $(this).addClass("active");
    $(".tavcon").addClass("dis");
    $(".tavcon").eq($(this).index()).removeClass("dis");
  });
  
  //配置我听平台树的相关参数
  var settingWT={
    view:{
      selectedMulti:false//是否允许同时选中多个节点
    },
    data:{
      simpleData:{
        enable: true
      }
    },
    callback:{
      onClick:selectWotingTreeNode
    }
  };
  //配置其他平台树的相关参数
  var settingOther={
    view:{
      selectedMulti:false//是否允许同时选中多个节点
    },
    data:{
      simpleData:{
        enable: true
      }
    },
    callback:{
      onClick:selectOtherTreeNode
    }
  };
   
  //加载我听和其他平台的树
  wtObj=$.fn.zTree.init($("#woting_tree"), settingWT);
  otherObj=$.fn.zTree.init($("#other_tree"), settingOther);
  
  //加载我听平台的树
  loadWtTree();
  function loadWtTree(){
    var _url=rootPath+"baseinfo/getChannelTree4View.do";
    var loadWtData=[{ChannelId:"",TreeViewType:"zTree"}];
    $.ajax({
      type:"POST",    
      url: _url,
      dataType:"json",
      data:loadWtData,
      success: function(returnData){
        if(returnData.ReturnType=="1001") {
          wtObj.addNodes(null,returnData.Data.children,false);
        }
      },
      error:function(jqXHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  }
  //加载其他平台的树
  loadOtherTree();
  function loadOtherTree(){
    var _url=rootPath+"baseinfo/getCCatalogTree4View.do";
    var loadWtData=[{ChannelId:"",TreeViewType:"zTree"}];
    $.ajax({
      type:"POST",    
      url: _url,
      dataType:"json",
      data:loadWtData,
      success: function(returnData){
        if(returnData.ReturnType=="1001") {
          otherObj.addNodes(null,returnData.Data.children,false);
        }
      },
      error:function(jqXHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  }
  
  //选中我听平台的分类，查询我听与其他平台的映射关系
  function selectWotingTreeNode(event, treeId, treeNode){
    var _url=rootPath+"common/getCCateRefs.do";
    var _data={"DictMId":"3","DictDId":treeNode.id,"SourceNum":"0"};
    $.ajax({
      type: "POST",    
      url: _url,
      dataType: "json",
      data:_data,
      success: function(returnData){
        $(".wt .right").html("");//清空数据
        if(returnData.ReturnType=="1001"){
          //加载和对应平台的栏目
          for(var i=0;i<returnData.ResultList.length;i++){          
            var li= '<li class="ri_li">'+
                      '<input type="radio" class="check ri_li_span" />'+
                      '<span class="ri_li_span fl">【我听】</span>'+
                      '<span class="ri_li_span fl">[音乐]</span>'+
                      '<span class="ri_li_span fl ml">对应</span>'+
                      '<span class="ri_li_span fl">【荔枝】</span>'+
                      '<span class="ri_li_span fl">[音乐生活]</span>'+
                    '</li>';
            $(".wt .right").append(li);        
          }
        }else{
          $(".wt .right").html("<li class='ri_li'>暂无对应关系</li>");
        }
      },
      error:function(jqXHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  }
  //选中其他平台的分类，查询其他平台与我听的映射关系
  function selectOtherTreeNode(){
    var _url=rootPath+"common/getCCateRefs.do";
    var _data={"DictMId":"3","DictDId":treeNode.id,"SourceNum":"1"};
    $.ajax({
      type: "POST",    
      url: _url,
      dataType: "json",
      data:_data,
      success: function(returnData){
        $(".other .right").html("");//清空数据
        if(returnData.ReturnType=="1001") {
          var pNode=treeNode.getParentNode();//当前选中节点的父节点
          for(var i=0;i<returnData.ResultList.length;i++){
            var li= '<li class="ri_li">'+
                      '<input type="radio" class="check ri_li_span" />'+
                      '<span class="ri_li_span fl">【我听】</span>'+
                      '<span class="ri_li_span fl">[音乐]</span>'+
                      '<span class="ri_li_span fl ml">对应</span>'+
                      '<span class="ri_li_span fl">【荔枝】</span>'+
                      '<span class="ri_li_span fl">[音乐生活]</span>'+
                    '</li>';
            $(".other .right").append(li);
          }
        }else{
          $(".other .right").html("<li class='ri_li'>暂无对应关系</li>");
        }
      },
      error:function(jqXHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  }
  
  //点击添加对应关系
  $("#add").on("click",function(){
    
  });
  
});
</script>
</html>
