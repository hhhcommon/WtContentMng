<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>电台管理</title>
  <meta name="keywords" content="">
  <meta name="description" content="">
  <link href="../resources/plugins/hplus/css/bootstrap.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/animate.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/style.min.css" rel="stylesheet">
  <link href="../resources/plugins/zTree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet"/>
  <link href="../resources/plugins/hplus/css/plugins/jqpagination/fy.css" rel="stylesheet"/>
  <link href="../resources/css/catalog.css" rel="stylesheet">
  <script src="../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
  <script src="../resources/plugins/zTree/js/jquery.ztree.core-3.5.js"></script>
  <script src="../resources/plugins/zTree/js/jquery.ztree.excheck-3.5.js"></script>
  <script src="../resources/plugins/zTree/js/jquery.ztree.exedit-3.5.js"></script>
  <script src="../resources/plugins/hplus/js/bootstrap.min.js"></script>
  <script src="../resources/plugins/hplus/js/content.min.js"></script>
  <script src="../resources/js/context.utils.js"></script>
  <script src="../resources/js/common.utils.js"></script>
<style type="text/css">
.detail{
  width: 100%;
  min-width: 500px;
  height: 400px;
  border: 1px solid red;
  overflow: auto;
}
.listBox {
  width: 100%;
  height: 100px;
  padding: 6px;
  border-bottom: 2px solid #f3f3f4;
  background: white;
  position: relative;
  cursor: pointer;
}
.listBox .listCheck {
  width: 6%;
  text-align: center;
  height: 78px;
  line-height: 78px;
}
.listBox .listImg, .listBox .listCon, .listBox .listCheck {
  float: left;
}
.listBox .listImg {
  height: 80px;
  width: 80px;
  margin-right: 15px;
  margin-left: 6px;
}
.listBox .listImg img {
  height: 100%;
  width: 100%;
}
.listBox .listCon {
  width: 70%;
  height: 100%;
}

.listBox .listCon h3 {
  font-size: 12px;
  margin-top: 0;
  margin-bottom: 2px;
  color: #0071CE;
  position: relative;
  display: inline-block;
  max-width: 180px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.listBox .secTitle,.listBox .playUrl,.listBox .other,.listBox .desc {
  font-size: 12px;
  color: #333;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.listBox p {
  margin: 0 0 2px;
}
.listBox .other span,.listBox .desc span {
  padding-right: 12px;
}
.detail .listBox .sortUpdate {
  width: 100px;
  height: 20px;
  position: absolute;
  top: 5px;
  right: 5px;
  display: none;
}
.detail .listBox .sortUpdate .sortNum {
  width: 60px;
  height: 20px;
  background-color: #f3f3f4;
  color: black;
  text-align: center;
  border: none;
  border-radius: 4px;
  outline: 0px;
}
.detail .listBox .sortUpdate .sortUpdateBtn {
  height: 20px;
  line-heihgt: 20px;
  width: 24px;
  margin: 0;
  padding: 0;
  border-radius: 20px;
  border: none;
}
.upl_pt{
  padding: 15px 0px 15px 0px;
}
.previewImg{
  width: 100px;
  height: 100px;
  border: 1px solid #dedede;
}
.previewImg img{
  background-size: 100% 100%;
  width: 100%;
  height: 100%;
}
.upfile{
  width: 10px !important;
  height: 10px;
  display: none !important;
}
#cataTrees{
  margin-top: 0px !important;
}
#cataTreess{
  width:450px;
  height: 145px;
  margin-left: 2px;
  margin-top: 0px !important;
  float: left;
  display: none;
}
#chooseParent1 ,#chooseParent2{
  width: 100px;
  height: 32px;
  margin-left:20px;
  font-size: 12px;
  line-height: 32px;
  float: left;
  text-align: center;
  cursor: pointer;
  border: 1px solid #e5e6e7;
}
.area{
  display: none;
}
</style>
</head>
<body style="overflow:hidden;">
  <div style="height:100%;background: white;">
    <!--菜单栏-->
    <div class="toobarArea">
      <button type="button" id="add" opeType="claAdd" class="btn" style="margin-right:3px;">添加</button>
      <button type="button" id="mod" opeType="claMod" class="btn" style="margin-right:3px;">修改</button>
      <button type="button" id="del" opeType="claDel" class="btn" style="margin-right:3px;">删除</button>
      <button type="button" id="sear" opeType="claSear" class="btn" style="margin-right:3px;">搜索</button>
    </div>
    <!--显示主区域-->
    <div class="mainArea">
      <!--左侧列表-->
      <div id="catListArea" class="catListArea">
        <!--动态加载分类列表-->
        <ul id="cataTree" class="ztree"></ul>
      </div>
      <!--右侧详情-->
      <div id="catDetailArea" class="catDetailArea">
        <!--动态加载电台分类详情-->
        <div class="col-sm-12">
          <div class="ibox float-e-margins">
            <h5>电台分类详情</h5>
            <div class="ibox-content">
              <div class="detail">
                <!--<div class="listBox" actid="" acttype="" columnid="">
                  <div class="listCheck"><input type="checkBox" name=""></div>
                  <div class="listImg">
                    <img alt="mage" src="http://pic.qingting.fm/2015/1221/20151221144845770.jpg!400">
                  </div>
                  <div class="listCon">
                    <h3>巴黎清理一地铁站难民营地 移送超1000名难民</h3>
                    <p class="secTitle">暂无</p>
                    <p class="other"><span>来源：null</span><span>2016年11月5日 </span></p>
                  </div>
                  <div class="sortUpdate">
                    <input type="text" class="sortNum" value="0">
                    <button class="sortUpdateBtn">OK</button>
                  </div>
                </div>-->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 遮罩 -->
    <div id="shade"></div>
    <!--弹出内容:添加分类-->
    <div id="addCata" class="modal inmodal" data-backdrop="static">
      <div class="modal-dialog" style="width:660px; margin:10px auto 0 auto">
        <div class="modal-content">
          <input type="text" class="treeId" style="display: none;" value="" obj="" />
          <input type="text" class="bcAreaId" style="display: none;" value=""/>
          <div class="modal-header" style="padding-bottom:5px;">
            <button type="button" class="close" id="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title" style="margin-bottom:5px;"></h4>
            <span id="catalogBelong">分类属于：</span>
            <span id="nodePath"></span>
          </div>
          <div class="modal-body my-mbody" style="padding-bottom:0px; 15px;">
            <form id="verOperForm" enctype ="multipart/form-data">
              <table>
                <tr>
                  <td class="th add-th">电台名称</td>
                  <td colspan="3"><input type="text" class="form-control" id="nodeNames" name="nodeNames" placeholder="电台名称" aria-required="true" style="margin-bottom:0px;"  autocomplete="off"></td>
                </tr>
                <tr>
                  <td class="th add-th">电台图片</td>
                  <td colspan="3">
                    <div class="upl_pt">
                      <input class="upfile" type="file" />
                      <div class="previewImg">
                        <img class="defaultImg" src="http://wotingfm.com:908/CM/resources/images/default.png" alt="font cover">
                      </div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td class="th add-th">播放地址</td>
                  <td colspan="3"><input type="text" class="form-control" id="url" name="url" placeholder="播放地址" aria-required="true" style="margin-bottom:0px;"  autocomplete="off"></td>
                </tr>
                <tr>
                  <td class="th add-th">发布者</td>
                  <td colspan="3"><input type="text" class="form-control" id="publisher" name="publisher" placeholder="发布者" aria-required="true" style="margin-bottom:0px;"  autocomplete="off"></td>
                </tr>
                <tr class="area">
                  <td class="th add-th">行政区域</td>
                  <td colspan="3">
                    <div style="width:450px;overflow: hidden;">
                      <input type="text" class="form-control" id="nodeParent1" name="nodeParent1" placeholder="行政区域id" aria-required="true" style="width:330px;margin-bottom:0px;display:none;float: left;">
                      <input type="text" class="form-control" id="nodeParents1" name="nodeParents1" placeholder="行政区域名字" aria-required="true" style="width:330px;margin-bottom:0px;float: left;">
                      <div id='chooseParent1'>选择区域</div>
                    </div>
                  </td>  
                </tr>
                <tr>
                  <td class="th add-th">父类电台</td>
                  <td colspan="3">
                    <!--<select class="form-control" id="nodeParent" name="nodeParent" placeholder="父ID"></select>-->
                    <div style="width:450px;overflow: hidden;">
                      <input type="text" class="form-control" id="nodeParent2" name="nodeParent2" placeholder="父电台id" aria-required="true" style="width:330px;margin-bottom:0px;display:none;float:left;">
                      <input type="text" class="form-control" id="nodeParents2" name="nodeParents2" placeholder="父电台名字" aria-required="true" style="width:330px;margin-bottom:0px;float:left;">
                      <div id='chooseParent2'>选择电台</div>
                    </div>
                    <ul id="cataTreess" class="ztree"></ul>
                  </td>  
                </tr>
                <tr>
                  <td class="th add-th">详细信息</td>
                  <td colspan="3"><textarea id="nodeDescn" name="nodeDescn" class="form-control" type="text" placeholder="详细信息" aria-required="true" style="margin-bottom:0px;margin-top:13px;"></textarea></td>
                </tr>
              </table>
            </form>
          </div>
          <div class="modal-footer" style="margin-top:60px;">
            <button id="save" type="button" class="btn btn-primary" style="position: absolute;left:513px;">提交</button>
            <button type="button" class="btn btn-white cancel" data-dismiss="modal">关闭</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
<script >
var zTreeObj,zTreeObjs,treeNode,rootNode,nodePathStr,modalNode;
var values='';//checkbox选中后，资源类型contentType里面的值
var rootPath=getRootPath();
var oPeType=1;//1新增，2修改
//需要加载的分类树的数据，以list方式给出
var loadTreeData=[{CatalogType:"2",RelLevel:"2",TreeViewType:"zTree"}, {CatalogType:"1",TreeViewType:"zTree"}, {CatalogType:"9",TreeViewType:"zTree"}];
//var loadModalTreeData=[{CatalogType:"1",TreeViewType:"zTree"}];

//初始化方法：页面加载完成后执行
$(function() {
  //0-初始化页面
  //0.1-初始化页面树样式
  zTreeObj=$.fn.zTree.init($("#cataTree"),{
    view:{
      selectedMulti: false//是否允许同时选中多个节点
    },
    edit:{
      enable: true,//是否开启异步模式
      showRemoveBtn: false,//是否显示删除按钮
      showRenameBtn: false//是否显示编辑名称按钮
    },
    check:{
      enable: false//设置 zTree的节点上是否显示 checkbox / radio
    },
    data:{
      simpleData:{
        enable: true
      }
    },
    callback:{
      onClick:reqDetailList
    }
  });
  
  //0.2--初始化弹出框的树(电台分类)
  zTreeObjss=$.fn.zTree.init($("#cataTreess"),{
    view:{
      selectedMulti: false//是否允许同时选中多个节点
    },
    edit:{
      enable: true,//是否开启异步模式
      showRemoveBtn: false,//是否显示删除按钮
      showRenameBtn: false//是否显示编辑名称按钮
    },
    check:{
      enable: false//设置 zTree的节点上是否显示 checkbox / radio
    },
    data:{
      simpleData:{
        enable: true
      }
    },
    callback:{
      onClick:onClick
    }
  });
  
  //1-加载数据
  //1.1-加载树
  loadTree(loadTreeData);
  //2-初始化按钮
  //2.1-点击添加按钮，增加新的分类
  $("#add").on("click",function(){
    cleanDialog();
    oPeType=1;
    getRootNode();
    $("#addCata").find(".modal-header>h4").html("添加电台分类");
  });
  //2.2-点击修改按钮，修改已有的分类
  $("#mod").on("click",function(){
    cleanDialog();
    oPeType=2;
    getRootNode();
    $("#addCata").find(".modal-header>h4").html("修改电台分类");
    $(document).find("input[type='checkbox']").each(function(){
      if($(this).is(':checked')){
        var bcId=$(this).parent().parent(".listBox").attr("contentid");
        $(".bcAreaId").val(bcId);
        var na=$(this).parent().siblings(".listCon").children("h3").text();
        $("#nodeNames").val(na);
        var img=$(this).parent().siblings(".listImg").children("img").attr("src");
        $(".defaultImg").attr({"src":img});
        var ul=$(this).parent().siblings(".listCon").children(".playUrl").text();
        $("#url").val(ul);
        var pub=$(this).parent().siblings(".listCon").children(".secTitle").text();
        $("#publisher").val(pub);
        var strid=$(this).parent().parent(".listBox").attr("strid");
        var strids=strid.split(",");
        var strmid=$(this).parent().parent(".listBox").attr("strmid");
        var strmids=strmid.split(",");
        var strtitle=$(this).parent().parent(".listBox").attr("strtitle");
        var strtitles=strtitle.split(",");
        var pna1="";
        var pid1="";
        var pna2="";
        var pid2="";
        for(var i=0;i<strmids.length;i++){
          if(strmids[i]=="2"||strmids[i]=="9"){
            if(pna1==""||pid1==""){
              var index=strtitles[i].lastIndexOf("\/");
              pna1=strtitles[i].substring(index + 1, strtitles[i].length);
              pid1=strtitles[i];
            }else{
              var index=strtitles[i].lastIndexOf("\/");
              var pnaa1=strtitles[i].substring(index + 1, strtitles[i].length);
              var pidd1=strtitles[i];
              pna1+=","+pnaa1;
              pid1+=","+pidd1;
            }
          }
          if(strmids[i]=="1"){
            if(pna2==""||pid2==""){
              var index=strtitles[i].lastIndexOf("\/");
              pna2=strtitles[i].substring(index + 1, strtitles[i].length);
              pid2=strtitles[i];
            }else{
              var index=strtitles[i].lastIndexOf("\/");
              var pnaa2=strtitles[i].substring(index + 1, strtitles[i].length);
              var pidd2=strtitles[i];
              pna2+=","+pnaa2;
              pid2+=","+pidd2;
            }
          }
        }
        $("#nodeParent1").val(pid1);
        $("#nodeParents1").val(pna1);
        $("#nodeParent2").val(pid2);
        $("#nodeParents2").val(pna2);
        var des=$(this).parent().siblings(".listCon").children(".desc").children(".descspan").text();
        $("#nodeDescn").val((dec=="null")?"":des);
      }
    })
    $("#shade").css({"display":"block"});
    $("#addCata").modal("show");
  });
  //2.3-点击删除按钮，删除已有的分类
  $("#del").on("click",function(){
    var check="";
    $(document).find("input[type='checkbox']").each(function(){
      if($(this).is(':checked')){
        var  contentid=$(this).parent().parent(".listBox").attr("contentid");
        if(check==""){
          check=contentid;
        }else{
          check+=","+contentid;
        }
      }
    });
    beforeRemove(check);
  });
  //2.4-点击提交按钮，提交表单
  $("#save").on("click",function(){
    if(oPeType=="1"){
      addBroadcast();
    }else{
      modBroadcast();
    }
  })
  //2.5-点击遮罩层,确定,取消按钮，遮罩层和弹出层消失
  $(".close,#shade,.cancel").on("click",function(){
    $("#addCata").modal("hide");
    $("#shade").css({"display":"none"});
    $(document).find("input[type='checkbox']").removeAttr("checked");
  });
  //2.6-点击上传图片
  $(".previewImg").on("click",function(){
    $(".upfile").click();
  }); 
  $(".upfile").change(function(){
    if($(".defaultImg").css("display")!="none"){
      $(".defaultImg").css({"display":"none"});
    }
    var _this=$(this);
    var fileReader = new FileReader();
    fileReader.onload = function(evt){
      if(FileReader.DONE==fileReader.readyState){
        var newImg =  $("<img  class='newImg' alt='front cover' />");
        newImg.attr({"src":this.result});//是Base64的data url数据
        if($(".previewImg").children().length>1){
          $(".previewImg img:last").replaceWith(newImg);
        }else{
          $(".previewImg").append(newImg);
        }
      }
    }
    fileReader.readAsDataURL($(this)[0].files[0]);
    var oMyForm = new FormData();
    oMyForm.append("ContentFile", $(this)[0].files[0]);
    oMyForm.append("UserId", "123");
    oMyForm.append("DeviceId", "3279A27149B24719991812E6ADBA5584");
    oMyForm.append("MobileClass", "Chrome");
    oMyForm.append("PCDType", "3");
    oMyForm.append("SrcType", "1");
    oMyForm.append("Purpose", "2");
    $.ajax({
      url:rootPath+"common/uploadCM.do",
      type:"POST",
      data:oMyForm,
      cache: false,
      processData: false,
      contentType: false,
      dataType:"json",
      //表单提交前进行验证
      success: function (opeResult){
        if(opeResult.ful[0].success=="TRUE"){
          _this.attr("value",opeResult.ful[0].FilePath);
        }else{
          alert(opeResult.err);
        }
      },
      error: function(XHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  });
  //2.7-点击选择区域，弹出树形分类
  $("#chooseParent1,#chooseParent2").on("click",function(){
    $("#cataTreess").slideDown("slow");
  });
  
 
  
});  

/**
 * 加载树
 */
function loadTree(loadData) {
  var _url=rootPath+"baseinfo/getCataTree4View.do";
  var i=0;
  loadRecursion(0);

  function loadRecursion(index) {
    if (index==loadData.length) return;
    $.ajax({
      type: "POST",    
      url: _url,
      dataType: "json",
      data: loadData[index++],
      success: function(jsonData){
        if(jsonData.ReturnType=="1001") {
            zTreeObj.addNodes(null,jsonData.Data,false);
            zTreeObjss.addNodes(null,jsonData.Data,false);  
        }
        loadRecursion(index);
      },
      error:function(jqXHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  }
}

/*与选中节点有关的操作*/
function getRootNode() {
  var nodes=zTreeObj.getSelectedNodes();//获取 zTree 当前被选中的节点数据集合
  treeNode=nodes[0]; //当前选中的节点
  if(!treeNode){
    alert("请先选中分类在进行操作");
    $("#shade").css({"display":"none"});
    $("#addCata").modal("hide");
  }else{
    alert("当前选中节点的id："+treeNode.id+"当前选中节点的名字:"+treeNode.name);
    nodePathStr=treeNode.attributes.pathName+"";
    if(nodePathStr.indexOf("/")>=0){
      rootNode=nodePathStr.split("/")[0];
    }else{
      rootNode=treeNode.attributes.pathName;
    }
    var modPathNames=nodePathStr.substring(0,nodePathStr.lastIndexOf('\/'));
    if(oPeType==1){
      $("#addCata").find(".modal-header>span:eq(1)").html(treeNode.attributes.pathName);
      $(".area").hide();
    }else{
      $("#addCata").find(".modal-header>span:eq(0)").hide();
      $("#addCata").find(".modal-header>span:eq(1)").hide();
      $(".area").show();
    }
    $(".bcAreaId").attr({"value":treeNode.id});
    $(".treeId").attr({"value":treeNode.id});
    $(".treeId").attr({"obj":treeNode});
    $("#shade").css({"display":"block"});
    $("#addCata").modal("show");
    console.log($(".treeId").attr("obj"),$(".treeId").attr("value"));
  }
}

/*选中某一分类，加载对应的列表详情*/
function reqDetailList(event, treeId, treeNode){
  var nodes=zTreeObj.getSelectedNodes();//获取 zTree 当前被选中的节点数据集合
  treeNode=nodes[0]; //当前选中的节点
  //alert("加载详情选中节点的id："+treeNode.id+"当前选中节点的名字:"+treeNode.name+"当前选中节点的根节点:"+treeNode.attributes.mId);
  var _data={
    "IMEI":"3279A27149B24719991812E6ADBA5583",
    "PCDType":"3",
    "UserId":"46BEA3E454EF2A7EACA873F0F30A1F1A",
    "CatalogType":treeNode.attributes.mId,
    "CatalogId":treeNode.id,
    "MediaType":"RADIO",
    "ResultType":"3",
    "PageSize":"100",
    "Page":"1"
  };
  $.ajax({
    type: "POST",    
    url:rootPath+"content/bc/getBroadcastList.do",
    dataType: "json",
    data:JSON.stringify(_data),
    success: function(resultData){
      if(resultData.ReturnType=="1001"){
        $(".detail").html("");
        loadDetailList(resultData);
      }
    },
    error: function(jqXHR){
      alert("发生错误" + jqXHR.status);
    }
  })
}
function loadDetailList(resultData){
  for(var i=0;i<resultData.ResultList.List.length;i++){
    if(!resultData.ResultList.List[i].List){
      var strId="",strTitle="",strMId="";
      if(resultData.ResultList.List[i].ContentCatalogs){
        for(var k=0;k<resultData.ResultList.List[i].ContentCatalogs.length;k++){
          var ssId=resultData.ResultList.List[i].ContentCatalogs[k].CataDid;
          var ssTitle=resultData.ResultList.List[i].ContentCatalogs[k].CataTitle;
          var ssMId=resultData.ResultList.List[i].ContentCatalogs[k].CataMId;
          if(strId==""){
            strId=ssId;
            strTitle=ssTitle;
            strMId=ssMId;
          }else{
            strId+=","+ssId;
            strTitle+=","+ssTitle;
            strMId+=","+ssMId;
          }
        }
      }
      var dl= '<div class="listBox" contentId='+resultData.ResultList.List[i].ContentId+' contentPub='+resultData.ResultList.List[i].ContentPub+' strId='+strId+' strTitle='+strTitle+' strMId='+strMId+'>'+
                '<div class="listCheck"><input type="checkBox" name=""></div>'+
                '<div class="listImg">'+
                  '<img alt="mage" src='+resultData.ResultList.List[i].ContentImg+'>'+
                '</div>'+
                '<div class="listCon">'+
                  '<h3>'+resultData.ResultList.List[i].ContentName+'</h3>'+
                  '<p class="secTitle">'+resultData.ResultList.List[i].ContentPub+'</p>'+
                  '<p class="playUrl">'+resultData.ResultList.List[i].ContentPlay+'</p>'+
                  '<p class="other"><span>来源：'+resultData.ResultList.List[i].ContentSource+'</span></p>'+
                  '<p class="desc"><span>描述：</span><span class="descspan">'+resultData.ResultList.List[i].ContentDescn+'</span></p>'+
                '</div>'+
                '<div class="sortUpdate">'+
                  '<input type="text" class="sortNum" value="0">'+
                  '<button class="sortUpdateBtn">OK</button>'+
                '</div>'+
              '</div>'
      $(".detail").append(dl);         
    }else{
      for(var j=0;j<resultData.ResultList.List[i].List.length;j++){
        var strId="",strTitle="",strMId="";
        if(resultData.ResultList.List[i].ContentCatalogs){
          for(var k=0;k<resultData.ResultList.List[i].ContentCatalogs.length;k++){
            var ssId=resultData.ResultList.List[i].ContentCatalogs[k].CataDid;
            var ssTitle=resultData.ResultList.List[i].ContentCatalogs[k].CataTitle;
            var ssMId=resultData.ResultList.List[i].ContentCatalogs[k].CataMId;
            if(strId==""){
              strId=ssId;
              strTitle=ssTitle;
              strMId=ssMId;
            }else{
              strId+=","+ssId;
              strTitle+=","+ssTitle;
              strMId+=","+ssMId;
            }
          }
        }
        var dl= '<div class="listBox" contentId='+resultData.ResultList.List[i].List[j].ContentId+' contentPub='+resultData.ResultList.List[i].ContentPub+' strId='+strId+' strTitle='+strTitle+' strMId='+strMId+'>'+
                  '<div class="listCheck"><input type="checkBox" name=""></div>'+
                  '<div class="listImg">'+
                    '<img alt="mage" src='+resultData.ResultList.List[i].List[j].ContentImg+'>'+
                  '</div>'+
                  '<div class="listCon">'+
                    '<h3>'+resultData.ResultList.List[i].List[j].ContentName+'</h3>'+
                    '<p class="secTitle">'+resultData.ResultList.List[i].List[j].ContentPub+'</p>'+
                    '<p class="playUrl">'+resultData.ResultList.List[i].List[j].ContentPlay+'</p>'+
                    '<p class="other"><span>来源：'+resultData.ResultList.List[i].List[j].ContentSource+'</span></p>'+
                    '<p class="desc"><span>描述：</span><span class="descspan">'+resultData.ResultList.List[i].ContentDescn+'</span></p>'+
                  '</div>'+
                  '<div class="sortUpdate">'+
                    '<input type="text" class="sortNum" value="0">'+
                    '<button class="sortUpdateBtn">OK</button>'+
                  '</div>'+
                '</div>'
        $(".detail").append(dl);         
      }
    }
  }
}
  
/*增加新分类的方法*/
function addBroadcast() {
  var addInfo={
      "DeviceId":"3279A27149B24719991812E6ADBA5584",
      "PCDType":"3",
      "UserId":"123",
      "BcTitle":$("#nodeNames").val(),
      "BcImg":$(".upfile").attr("value"),
      "BcAreaId":$(".bcAreaId").attr("value"),
      "BcTypeId":$("#nodeParent2").val(),
      "BcPlayPath":$("#url").val(),
      "IsMain":"1",
      "BcPublisher":$("#publisher").val(),
      "Descn":$("#nodeDescn").val()
  };
  $.ajax({
    type: "POST",    
    url:rootPath+"content/bc/addBroadcast.do",
    dataType: "json",
    data:JSON.stringify(addInfo),
    success: function(resultData){
      if(resultData.ReturnType=="1001"){
        cleanDialog();
        alert("添加成功!");
        $("#addCata").modal("hide");
        $("#shade").css({"display":"none"});
        reqDetailList(event,$(".treeId").attr("value"),$(".treeId").attr("obj"));
      }else{
        alert("发生错误：\n\t"+resultData.ReturnType+"-"+resultData.Message);
      }
    },
    error: function(jqXHR){
      alert("发生错误" + jqXHR.status);
    }
  })
}

/*点击弹出窗里面的树上的节点*/
function onClick(event, treeId, treeNode) {
  var node=zTreeObjss.getSelectedNodes();//获取 模态框里zTree当前被选中的节点数据集合
  modalNode=node[0]; //当前选中的节点
  if(modalNode.attributes.mId=="1"){
    $("#nodeParent2").val(modalNode.id);
    $("#nodeParents2").val(modalNode.name);
  }else{
    $("#nodeParent1").val(modalNode.id);
    $("#nodeParents1").val(modalNode.name);
  }
  $("#cataTreess").slideUp("slow");
};
/*修改已有分类的方法*/
function modBroadcast() {
  var modInfo={
      "DeviceId":"3279A27149B24719991812E6ADBA5584",
      "PCDType":"3",
      "UserId":"123",
      "BcId":$(".bcAreaId").val(),
      "BcTitle":$("#nodeNames").val(),
      "BcImg":$(".upfile").attr("value"),
      "BcAreaId":$("#nodeParent1").val(),
      "BcTypeId":$("#nodeParent2").val(),
      "BcPlayPath":$("#url").val(),
      "IsMain":"1",
      "BcPublisher":$("#publisher").val(),
      "Descn":$("#nodeDescn").val()
  };
  $.ajax({
    type: "POST",    
    url:rootPath+"content/bc/updateBroadcast.do",
    dataType: "json",
    data:JSON.stringify(modInfo),
    success: function(resultData){
      if(resultData.ReturnType=="1001"){
        cleanDialog();
        alert("修改成功");
        $(document).find("input[type='checkbox']").removeAttr("checked");
        $("#addCata").modal("hide");
        $("#shade").css({"display":"none"});
      }
    },
    error: function(jqXHR){
      alert("发生错误" + jqXHR.status);
    }
  })
};

//删除节点的时候验证是否删除
function beforeRemove(check){
  if(confirm("确认删除这些电台 吗？")){
    delBroadcast(check);
  }else{
    alert("成功取消删除");
  }
}

/*删除已有分类的方法*/
function delBroadcast(check) {
  var delInfo={
    "DeviceId":"3279A27149B24719991812E6ADBA5584",
    "PCDType":"3",
    "UserId":"123",
    "Ids":check
  };
  $.ajax({
    type: "POST",    
    url:rootPath+"content/bc/delBc.do",
    dataType: "json",
    data:JSON.stringify(delInfo),
    success: function(resultData){
      if(resultData.ReturnType=="1001"){
        alert("删除成功!");
      }else{
        alert("发生错误：\n\t"+resultData.ReturnType+"-"+resultData.Message);
      }
    },
    error: function(jqXHR){
      alert("发生错误" + jqXHR.status);
    }
  })
};

/*清空分类界面方法*/
function cleanDialog() {
  $("form")[0].reset();
  $(".newImg").remove();
  $(".defaultImg").show();
}
</script>
</html>
