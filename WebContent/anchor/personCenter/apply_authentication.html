<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>主播申请认证</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="我听，我享听">
  <meta name="description" content="我听，我享听">
  <link href="../../resources/plugins/hplus/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/animate.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/style.min.css" rel="stylesheet">
  <script src="../../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
  <script src="../../resources/plugins/hplus/js/bootstrap.min.js"></script>
  <script src="../../resources/js/context.utils.js"></script>
</head>
<style>
*{margin: 0;padding: 0;}
li{list-style: none;}
a,a:hover,a:link,a:focus,a:visited{text-decoration: none;}
::-webkit-scrollbar {height:12px;width:2px;background:#e7eaec; } 
::-webkit-scrollbar-thumb{height:12px;width:2px;background:#e7eaec;}
body{-moz-user-select: none;overflow-x: auto;}
.fl{float: left;}
.fr{float: right;}
.dis{display: none;}
input[type=file] {display: none;}
.ellipsis{
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.detail{
  width:1084px;
  min-width:780px;
  height:auto;
  overflow: hidden;
  background: #fff;
  /*border:1px solid #dedede;*/
}
.detail_title{
  width: calc(100% - 30px);
  height: 40px;
  color: #000;
  font-family: "微软雅黑";
  font-size: 13px;
  line-height: 40px;
  padding-left: 15px;
}
.detail_content{
  width:calc(100% - 30px);
  position: relative;
  margin: 0px 15px 20px 15px;
  height: auto;
}
.dc_title1{
  width: 100%;
  height: 40px;
  line-height: 40px;
}
.dct1_txt1{
  width: 4px;
  height: 15px;
  margin-top: 12px;
  float: left;
  border-radius: 3px;
  background: #FFA634;
}
.dct1_txt2{
  color: #000;
  font-weight: bold;
  font-size: 14px;
  line-height: 40px;
  margin: 0px 0px 0px 10px;
}
.dct1_txt3{
  color: #000;
  width: 60px;
  height: 25px;
  text-align: center;
  line-height: 25px;
  border-radius: 20px;
  margin: 10px 0px 0px 10px;
  background: rgba(51,122,183,0.3);
}
.dc1,.dc2{
  height: 30px;
  overflow: hidden;
  margin:15px 0px 30px 0px;
}
.dc1_span,.dc2_span,.dc3_span,.dc4_span{
  width: 75px;
  line-height: 30px;
  color: #000;
  font-size: 14px;
  font-weight: bold;
  text-align: left;
}
.dc1_ipt,.dc2_ipt{
  width: 740px;
  height: 30px;
  border: 1px solid #dedede;
  padding: 2px 4px;
  margin: 0px 0px 0px 5px;
}
.dc3{
  height: 310px;
  overflow: hidden;
  border-bottom: 1px solid #dedede;
}
.dc4{
  height: 120px;
  overflow: hidden;
}
.dc3_ul,.dc4_ul{
  width: calc(100% - 80px);
  margin: 0px 0px 0px 5px;
  overflow: hidden;
}
.dc4_ul{width: calc(100% - 95px);}
.dc3_li{
  position: relative;
  width:180px;
  height:120px;
  margin:0px 20px 0px 0px;
}
.pic1,.pic2,.pic3,.pic4,.newImg{
  width:100%;
  height:100%;
  cursor: pointer;
  border:1px solid #dedede;
  background-size:100% 100%;
}
.dc4_li{margin: 20px 0px 0px 80px;}
.dc4_li span{
  display: block;
  margin: 0px;
  height: 30px;
  line-height: 30px;
  color: #000;
}
.approve{
  width: 80px;
  height: 30px;
  background: #ffa634;
  margin: 20px 0px 20px 80px;
  border: none;
  display: block;
  color: #fff;
  position: relative;
}
.waiting_div{
  position: absolute;
  width: 100%;
  height: 100%;
  margin-top:-66%;
  background: rgba(0,0,0,0.2);
}
.waiting_img{
  width: 45px;
  height: 45px;
  margin: 28px 68px;
  background-size: 100% 100%;
  position: relative;
}
.allmask{
  position: relative;
  width: 1084px;
  height: 720px;
  top: -730px;
  overflow: hidden;
  background: #fff;
}
.pp1{
  position: fixed;
  left: 40%;
  top: 90px;
}
.allnote1{
  width: auto;
  color: #000;
  font-size: 18px;
  top: 205px;
  position: fixed;
  left: 26%;
}
.allnote2{
  color: #ddd;
  font-size: 14px;
  top: 245px;
  position: fixed;
  left: 34%;
}
.ast{
  color: #ffa634;
  margin: 0px 2px;
  font-size: 14px;
}
</style>
<body>
<div class="detail">
  <div class="detail_title">账号设置> 主播申请认证</div>
  <div class="detail_content">
    <div class="dc_title1">
      <div class="dct1_txt1 fl"></div>
      <div class="dct1_txt2 fl">实名认证</div>
      <div class="dct1_txt3 fl dis">已通过</div>
    </div>
    <div class="dc1">
      <div class="dc1_span fl">真实姓名<span class="ast">*</span>:</div>
      <input type="text" class="dc1_ipt fl" placeholder="填写你的真实姓名" />
    </div>
    <div class="dc2">
      <div class="dc2_span fl">身份证号<span class="ast">*</span>:</div>
      <input type="text" class="dc2_ipt fl" placeholder="填写你的身份证号" />
    </div>
    <div class="dc3">
      <div class="dc3_span fl">证件照片<span class="ast">*</span>:</div>
      <ul class="dc3_ul fl">
        <li class="dc3_li fl pic1_li">
          <img src="../anchorResource/img/pic1.png" alt="身份证正面" class="dc3_img pic1"/>
          <input type="file" class="dc3_file pic1_file dis" index='1'/>
          <div class="waiting_div dis">
            <img src="../anchorResource/img/waiting_circle.gif" alt="图片上传等待" class="waiting_img"/>
          </div>
        </li>
        <li class="dc3_li fl pic2_li">
          <img src="../anchorResource/img/pic2.png" alt="身份证背面" class="dc3_img pic2"/>
          <input type="file" class="dc3_file pic2_file dis" index='2'/>
          <div class="waiting_div dis">
            <img src="../anchorResource/img/waiting_circle.gif" alt="图片上传等待" class="waiting_img"/>
          </div>
        </li>
        <li class="dc3_li fl pic3_li">
          <img src="../anchorResource/img/pic3.png" alt="手持身份证" class="dc3_img pic3"/>
          <input type="file" class="dc3_file pic3_file dis" index='3'/>
          <div class="waiting_div dis">
            <img src="../anchorResource/img/waiting_circle.gif" alt="图片上传等待" class="waiting_img"/>
          </div>
        </li>
      </ul>
      <div class="dc4_li fl">
        <span>证件照片将会进行人工审核,请务必遵循以下要求:</span>
        <span>1.上传一张主播手持身份证原件的正面照片并确保本人面部完整出相;</span>
        <span>2.图像与文字显示清晰</span>
        <span>3.图片格式为:png,jpg</span>
        <span>4.图片大小不超过5M</span>
      </div>
    </div>
    <div class="dc_title1" style="margin: 10px 0px;">
      <div class="dct1_txt1 fl"></div>
      <div class="dct1_txt2 fl">资格认证</div>
      <div class="dct1_txt3 fl dis">已通过</div>
    </div>
    <div class="dc4">
      <span class="dc4_span fl">证件照片:</span>
      <ul class="dc4_ul fl">
        <li class="dc3_li fl pic4_li">
          <img src="../anchorResource/img/pic3.png" alt="证件照片" class="dc3_img pic4"/>
          <input type="file"  class="dc3_file pic4_file dis" index='4'/>
          <div class="waiting_div dis">
            <img src="../anchorResource/img/waiting_circle.gif" alt="图片上传等待" class="waiting_img"/>
          </div>
        </li>
      </ul>
    </div>
    <button class="approve">立即提交</button>
  </div>
</div>
<div class="allmask dis">
  <img src="../../anchor/anchorResource/img/pp1.png" alt="审核中提示" class="pp1" />
  <div class="allnote1">提交成功,请耐心等待工作人员审核...</div>
  <div class="allnote2">预计3个工作日内审核完成</div>     
</div>
</body>
<script>
$(function(){
  var rootPath=getRootPath();
  var userId=$(".login_user span",parent.document).attr("userid");
  
  //先获取用户申请认证的流程
  var data1={"UserId":userId,"PCDType":"3"};
  getApproveProgress(data1);
  function getApproveProgress(dataParam){
    $.ajax({
      url:rootPath+"security/getApproveProgress.do",
      type:"POST",
      data:JSON.stringify(dataParam),
      cache: false,
      async: false,
      dataType:"json",
      success:function(resultData){
        if(resultData.ReturnType=="1001"){ 
          if(resultData.approveInfo.reState=="0"){//审核中
            $(".allmask").removeClass("dis");
            $("body").css("overflow","hidden");     
          }else if(resultData.approveInfo.reState=="1"){//通过
            
            getApproveInfo(data1);//获取用户申请认证详细信息
          }else{//不通过
            
            getApproveInfo(data1);//获取用户申请认证详细信息
          }
        }
      },
      error: function(jqXHR){
        alert("获取用户申请认证的流程发生错误:" + jqXHR.status);
      }
    });
  }
  
  //获取用户申请认证详细信息
  function getApproveInfo(dataParam){
    $.ajax({
      url:rootPath+"security/getApproveInfo.do",
      type:"POST",
      data:JSON.stringify(dataParam),
      async: false,
      dataType:"json",
      success:function(resultData){
        if(resultData.ReturnType=="1001"){ 
          fillApproveInfo(resultData);//填充用户申请认证详细信息
        }else{
          alert("获取用户申请认证的详细信息"+resultData.Message);
        }
      },
      error: function(jqXHR){
        alert("获取用户申请认证的详细信息发生错误:" + jqXHR.status);
      }
    });
  }
  //填充用户申请认证详细信息
  function fillApproveInfo(resultData){
    $(".dc1_ipt").val((resultData.approveInfo.reallyName)?(resultData.approveInfo.reallyName):"未知");
    $(".dc2_ipt").val((resultData.approveInfo.iDCard)?(resultData.approveInfo.iDCard):"未知");
    if(resultData.approveInfo.frontImg){
      $(".pic1_li .dc3_img").attr("src",resultData.approveInfo.frontImg);
      $(".pic1_li").attr("path",resultData.approveInfo.frontImg);
    }
    if(resultData.approveInfo.reverseImg){
      $(".pic2_li .dc3_img").attr("src",resultData.approveInfo.reverseImg);
      $(".pic2_li").attr("path",resultData.approveInfo.reverseImg);
    }
    if(resultData.approveInfo.mixImg){
      $(".pic3_li .dc3_img").attr("src",resultData.approveInfo.mixImg);
      $(".pic3_li").attr("path",resultData.approveInfo.mixImg);
    }
    if(resultData.approveInfo.auchorCardImg){
      $(".pic4_li .dc3_img").attr("src",resultData.approveInfo.auchorCardImg);
      $(".pic4_li").attr("path",resultData.approveInfo.auchorCardImg);
    }
  }
  
  //点击上传身份证正面照片
  $(document).on("click",".pic1",function(){
    $(".pic1_file").click();
  });
  $(document).on("change",".pic1_file",function(){
    var obj_file=$(this);
    uploadFile(obj_file);
  });
  //点击上传身份证背面照片
  $(document).on("click",".pic2",function(){
    $(".pic2_file").click();
  });
  $(document).on("change",".pic2_file",function(){
    var obj_file=$(this);
    uploadFile(obj_file);
  });
  //点击上传手持身份证照片
  $(document).on("click",".pic3",function(){
    $(".pic3_file").click();
  });
  $(document).on("change",".pic3_file",function(){
    var obj_file=$(this);
    uploadFile(obj_file);
  });
  //点击上传资格证照片
  $(document).on("click",".pic4",function(){
    $(".pic4_file").click();
  });
  $(document).on("change",".pic4_file",function(){
    var obj_file=$(this);
    uploadFile(obj_file);
  });
  function uploadFile(obj){
    var index=$(obj).attr("index");
    $(obj).parent(".dc3_li").attr("path","");
    $(obj).siblings(".newImg").remove();
    var oMyForm = new FormData();
    oMyForm.append("ContentFile",$(obj)[0].files[0]);
    oMyForm.append("MobileClass", "Chrome");
    oMyForm.append("PCDType", "3");
    oMyForm.append("UserId", userId);
    oMyForm.append("SrcType", "1");
    oMyForm.append("Purpose", "5");
    requestUpload(index,obj,oMyForm);//请求上传文件
  }
  
  //请求上传文件
  function requestUpload(index,obj,oMyForm){
    var newObj=$(obj);
    var objSib=$(obj).siblings(".dc3_img");
    var objPar=$(obj).parent(".dc3_li");
    var objWai=$(obj).siblings(".waiting_div");
    var objPic=$(obj).parent(".dc3_li").children(".dc3_img");
    var objPicl=$(obj).parent(".dc3_li").children(".dc3_img:last");
    $.ajax({
      url:rootPath+"common/uploadCM.do",
      type:"POST",
      data:oMyForm,
      cache: false,
      processData: false,
      contentType: false,
      dataType:"json",
      beforeSend:function(){
        $(objWai).removeClass("dis");
        $(".approve").attr("disabled","disabled").css("background","#ddd");
      },
      success:function(resultData){
        if(resultData.Success==true){ 
          $(objPar).attr({"path":resultData.FilePath});
          if($(objSib).css("display")!="none"){
            $(objSib).css({"display":"none"});
          }
          var newImg=$("<img class='newImg' src="+resultData.FilePath+" alt='front cover' />");
          $(newImg).addClass("pic"+index);
          if($(objPic).length>1){
            $(objPicl).replaceWith(newImg);
          }else{
            $(objPar).append(newImg);
          } 
        }else{
          alert("上传图片失败"+resultData.err);
        }
        $(objWai).removeClass("dis");
        $(".approve").removeAttr("disabled").css("background","#0077c7");
      },
      error: function(jqXHR){
        alert("上传文件发生错误:" + jqXHR.status);
        $(objWai).removeClass("dis");
      }
    });
    var jqObj=obj;
    jqObj.val("");
    var domObj = jqObj[0];
    domObj.outerHTML = domObj.outerHTML;
    var newJqObj = jqObj.clone();
    jqObj.before(newJqObj);
    jqObj.remove();
    newObj.unbind().change(function (){
      uploadFile();
    });
  }
  //点击立即申请
  $(".approve").on("click",function(){
    var data={};
    var roleId1="c8bb51b762594345bb6bc5b297c14f93";//实名认证角色的id
    var roleId2="4b222905d78741a89d72c6b4759c3e5f";//资格认证角色的id
    data.UserId=userId;
    data.PCDType="3";
    data.Flag="1";
    data.ReallyName=$.trim($(".dc1_ipt").val());
    data.IDCard=$.trim($(".dc2_ipt").val());
    if($(".pic1_li").attr("path")!='') data.FrontImg=$(".pic1_li").attr("path"); 
    if($(".pic2_li").attr("path")!='') data.ReverseImg=$(".pic2_li").attr("path"); 
    if($(".pic3_li").attr("path")!='') data.MixImg=$(".pic3_li").attr("path"); 
    if($(".pic4_li").attr("path")!='') data.AnchorCardImg=$(".pic4_li").attr("path"); 
    if(data.FrontImg&&data.ReverseImg&&data.MixImg&&data.AnchorCardImg){
      data.ApplyRoleId=roleId2;//资格认证
    }else{
      if(data.FrontImg&&data.ReverseImg&&data.MixImg){
        data.ApplyRoleId=roleId1;//实名认证
      }else{
        alert("请按要求提交照片");
        return;
      }
    }
    $.ajax({
      url:rootPath+"security/approveRole.do",
      type:"POST",
      data:JSON.stringify(data),
      cache: false,
      processData: false,
      contentType: false,
      dataType:"json",
      beforeSend:function(){
        $(".approve").attr("disabled","disabled").css("background","#ddd");
      },
      success:function(resultData){
        if(resultData.ReturnType=="1001"){ 
          alert("申请提交成功");
//        getApproveProgress(data1);
        }
        $(".approve").removeAttr("disabled").css("background","#0077c7");
      },
      error: function(jqXHR){
        alert("申请提交发生错误:" + jqXHR.status);
        $(".approve").removeAttr("disabled").css("background","#0077c7");
      }
    });
  });
  
});
</script>

</html>
