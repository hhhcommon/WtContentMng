<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
  <title>修改密码</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="我听，我享听">
  <meta name="description" content="我听，我享听">
  <link href="../../resources/plugins/hplus/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/animate.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/style.min.css" rel="stylesheet">
  <script src="../../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
  <script src="../../resources/js/context.utils.js"></script>
</head>
<style>
*{margin: 0;padding: 0;}
li{list-style: none;}
a,a:hover,a:link,a:focus,a:visited{text-decoration: none;}
::-webkit-scrollbar {height:12px;width:2px;background:#e7eaec; } 
::-webkit-scrollbar-thumb{height:12px;width:2px;background:#e7eaec;}
body{-moz-user-select: none;overflow-x: auto;}
.detail{
  height:100%;
  overflow: auto;
  background: #fff;
  border:1px solid #dedede;
}
.detail_title{
  width: 100%;
  height: 35px;
  color: #000;
  font-size: 14px;
  margin-top: 20px;
  padding-left:20px;
}
.containers{
  height:300px;
  width:500px;
  margin:20px 0px 0px 20px;
}
.note{
  width: 100%;
  height: 20px;
  overflow: hidden;
  margin: 0px 0px 20px 0px;
}
.note1{
  width: 14px;
  height: 14px;
  border-radius: 7px;
  text-align: center;
  line-height: 14px;
  display: inline-block;
  margin-top: 2px;
  float: left;
  font-size: 12px;
  color: #fff;
  background: #FFA634;
}
.note2{
  float: left;
  margin: 0px 0px 0px 5px;
  color: #000;
}
.form-horizontal .form-group{
  margin:0px 0px 30px 0px;
  overflow: hidden;
}
.form-horizontal .form-group:last-child{
  margin-top:40px;
}
.form-horizontal{
  width:330px;
  height:auto;
}
.label_div{
  width: 92px;
  height: 35px;
  line-height: 35px;
  font-weight: 600;
  padding-left: 0px;
  padding-right: 0px;
  font-size: 14px;
  color: #000;
  font-family: "微软雅黑";
  float: left;
}
.label_div .ast {
  color: #ffa634;
}
.pass_ipt{
  width:185px;
  height:35px;
  float: left;
}
.password,.password1,.password2{
  width:100%;
  height:35px;
  border: 1px solid #dedede;
}
.eye_close{
  width:20px;
  height:20px;
  margin-top:9px;
  margin-left:10px;
  float: left;
}
.confirm,.cancel{
  width:90px;
  height:30px;
  border: none;
  color:#fff;
  font-size:16px;
  font-family: "微软雅黑";
  font-weight:500;
  float: left;
}
.confirm{
  margin-left:92px;
  background: #ffa634;
}
.cancel{
  background: #000;
  margin-left:40px;
}
</style>
<body onselectstart="return false">
	<div class="detail">
	  <div class="detail_title">账号设置> 修改密码</div>
	  <div class="containers">
	    <div class="note">
	      <span class="note1">!</span>
	      <span class="note2">您的密码安全度较低,建议使用6-16位数字和字母组成密码</span>
	    </div>
	    <form class="form-horizontal">
        <div class="form-group">
          <div class="label_div">输入原密码<span class="ast">*</span>：</div>
          <div class="pass_ipt">
            <input type="password" class="password"/>
          </div>
          <img class="eye_close" src="../anchorResource/img/pass1.png" alt="密码显示" />
        </div>
        <div class="form-group">
          <div class="label_div">输入新密码<span class="ast">*</span>：</div>
          <div class="pass_ipt">
            <input type="password" class="password1"/>
          </div>
          <img class="eye_close" src="../anchorResource/img/pass2.png" alt="密码显示" />
        </div>
        <div class="form-group">
          <div class="label_div">确认新密码<span class="ast">*</span>：</div>
          <div class="pass_ipt">
            <input type="password" class="password2"/>
          </div>
          <img class="eye_close" src="../anchorResource/img/pass2.png" alt="密码显示" />
        </div>
        <div class="form-group">
          <input  class="confirm" type="button" value="保存设置" />
        </div>
      </form> 
    </div>
	</div>   
</body>
<script>
$(function(){
  var rootPath=getRootPath();
  
  var psd=$(".login_user span",parent.document).attr("userpsd");
  var uid=$(".login_user span",parent.document).attr("userid");
  var pcdType=3;
   
  //点击保存设置
  $(".confirm").on("click",function(){
    updatePwd(psd);
  });
  
  function updatePwd(psd){
    var psd0=$.trim($(".password").val());
    var psd1=$.trim($(".password1").val());
    var psd2=$.trim($(".password2").val());
    if(psd0&&psd1&&psd2){//原密码，新密码，确认密码都不为空
      if(psd0!=psd){//输入的原密码与真实的原密码不一致
        alert("输入的原密码不正确,请重新输入"); 
        $(".password").val("").focus();
        return false;
      }
      if(psd0==psd1){//新密码和旧密码相同
        alert("新密码和旧密码一样,请重新输入");
        $(".password1").val("").focus();
        return false;
      }else{
        if(psd1!=psd2){//新密码和确认的密码不一样
          alert("确认密码和新密码不一致,请重新输入");
          $(".password2").val("").focus();
          return false;
        }else{
          var data={};
          data.PCDType=pcdType;
          data.UserId=uid;
          data.OldPassword=psd;
          data.NewPassword=psd2;
          $.ajax({
            type:"POST",
            url:rootPath+"passport/user/updatePwd.do",
            dataType:"json",
            data:JSON.stringify(data),
            beforeSend:function(){
              $(".confirm").attr("disabled","disabled").css("background","#dedede");;
            },
            success: function(returnData){
              if(returnData.ReturnType=="1001"){
                alert("密码修改成功!");
              }else{
                alert("修改密码失败:"+returnData.Message);
              }
              $(".confirm").removeAttr("disabled").css("background","#ffa634");
            },
            error:function(jqXHR){
              alert("修改密码发生错误:" + jqXHR.status);
            }
          });
        }
      }
    }else{
      if(!psd0){
        alert("原密码不能为空");
        $(".password").focus();
        return false;
      }else{
        if(!psd1){
          alert("新密码不能为空");
          $(".password1").focus();
          return false;
        }else{
          if(!psd2){
            alert("确认密码不能为空");
            $(".password2").focus();
            return false;
          }
        }
      }
    }
  }
});
</script>
</html>
