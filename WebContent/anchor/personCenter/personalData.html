<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>个人资料</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <link href="../../resources/plugins/hplus/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/animate.min.css" rel="stylesheet">
  <link href="../../resources/plugins/hplus/css/style.min.css" rel="stylesheet">
  <script src="../../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
  <script src="../../resources/js/context.utils.js"></script>
  <!--日历插件-->
  <script src="../../resources/plugins/hplus/js/plugins/layer/laydate/laydate.js"></script>
  <script src="../../resources/plugins/hplus/js/bootstrap.min.js"></script>
</head>
<style>
*{margin: 0;padding: 0;}
li{list-style: none;}
a,a:hover,a:link,a:focus,a:visited{text-decoration: none;}
::-webkit-scrollbar {height:12px;width:2px;background:#e7eaec; } 
::-webkit-scrollbar-thumb{height:12px;width:2px;background:#e7eaec;}
body{-moz-user-select: none;overflow-x: auto;}
input{padding:0px 4px;}
.col-sm-10{
  padding-left:0px;
}
.detail{
  width:1084px;
  min-width:780px;
  height:auto;
  overflow: auto;
  margin-bottom:20px;
  background: #fff;
  border:1px solid #dedede;
}
.detail_title{
  width: calc(100% - 30px);
  height: 40px;
  color: #000;
  font-family: "微软雅黑";
  font-size: 13px;
  line-height: 40px;
  padding-left: 15px;
}
.detail_content{
  width:100%;
  position: relative;
  margin-top:20px;
  height:550px;
}
@media (min-width: 768px){
  .col-sm-10 {
    width: calc(100% - 120px ) !important;
    padding-left: 0px;
    float: left;
  }
}
.left_content{
  width:66%;
  height:auto;
  position: relative;
  float: left;
  padding: 0px 0px 0px 15px;
  margin-right: 35px;
}
.left_content .row,
.form-horizontal .form-group{
  margin:0px 0px 15px !important;
  overflow: hidden;
}
.col-sm-12{
  padding-left:0px;
}
.form-horizontal .control-label{
  font-size: 16px;
  color: #000;
  font-family: "微软雅黑";
  text-align: center;
  width: auto !important;
  padding-left: 0px;
  padding-right: 0px;
  float: left;
  line-height: 37px;
}
.control-label .ast {
  color: #ffa634;
}
.nickname,.realname,.phone,.mail{
  width:calc(100% - 10px);
  height: 35px;
  color: #000;
  border: 1px solid #dedede;
}
.signature,.info,.introduction{
  width:calc(100% - 8px);
  min-height:50px;
  border: 1px solid #dedede;
  resize:none;
}
.birthday_container{
  width:100%;
  min-height:37px;
  overflow: hidden;
}
.btn-group{
  float: left;
  height: 37px;
  margin-right: 10px;
}
.year,.month,.day{
  width: 90px;
  height: 35px;
  line-height: 35px;
  padding-left: 8px;
  border: 1px solid #dedede;
  font-size: 15px;
  color: #000 !important;
  display: inline-block;
  padding-right: 14px;
}
.sex{
  width:100%;
  height:37px;
  overflow: hidden;
}
.male_div,.female_div,.secret_div{
  float: left;
  height:35px;
  margin-right:55px;
}
input[type=checkbox]{
  margin:10px 5px 0px 0px;
}
.male,.female,.secret{
  width:20px;
  height:20px;
  float: left;
  display: inline-block;
}
.male_span,.female_span,.secret_span{
  color: #333;
  line-height: 40px;
  float: left; 
  font-size:14px;
  display: inline-block;
}
.phone,.mail{
  height:35px;
  line-height:35px;
}
.saveSet{
  width: 100px;
  height: 30px;
  border: 1px solid #dedede;
  border-radius: 2px;
  background: #ffa634;
  color: #fff;
  float: left;
  margin-left: 85px;
  margin-top:25px;
}
.right_content{
  width:25%;
  height:auto;
  float: left;
  padding:0px 0px 0px 20px;
}
.portrait{
  width:180px;
  height:180px;
  margin-top:20px;
}
.portrait img{
  width:100%;
  height:100%;
  background-size:100% 100%;
}
.txt_p1{
  margin-top:10px;
  padding-left: 40px; 
}
.txt_p2{
  margin-top:10px;
  padding-left:10px; 
}
.replace_portrait{
  width: 100px;
  height: 30px;
  background: #ffa634;
  color: #fff;
  font-family: "微软雅黑";
  font-size: 16px;
  text-align: center;
  line-height: 30px;
  cursor: pointer;
  margin-left:33px;
}
.dropdown-menu{
  min-width: 90px;
}
.caret{
  margin-left:40px;
  margin-top:-5px;
}
.year_menu,.month_menu,.day_menu{
  height:204px;
  overflow: auto;
}
.dropdown{
  float: left;
  width:32.3% !important;
}
.dropdown-menu>li>a:focus, .dropdown-menu>li>a:hover {
  color: #ffa364;
}
.birthday_container .dropdown:nth-child(1){
  margin-left:0px;
}
.birthday_container .dropdown:nth-child(2){
  margin-left:1%;
}
.birthday_container .dropdown:nth-child(3){
  margin-left:1%;
}
.mask_gif{
  width: 180px;
  height: 180px;
  position: relative;
  top:-180px;
  background: rgba(0,0,0,0.6);
  display: none;
}
.mask_gif img{
  width: 25px;
  height: 25px;
  position: relative;
  margin-top: 60px;
  margin-left: 70px;
}
</style>
<body onselectstart="return false">
<div class="detail">
  <div class="detail_title">账号设置> 个人资料</div>
    <div class="detail_content">
      <div class="left_content container">
      	<div class="row">
          <div class="col-sm-12">
            <form action="" class="form-horizontal">
              <div class="form-group">
                <label class="col-sm-2 control-label">昵&emsp;&emsp;称<span class="ast">*</span>：</label>
                <div class="col-sm-10">
                  <input type="text" class="nickname" placeholder="我是主播">
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">性&emsp;&emsp;别<span style="color:#fff;">*</span>：</label>
                <div class="col-sm-10">
                  <div class="sex">  
                    <div class="male_div">
                      <input type="checkbox" class="male" name="sexx"/>
                      <span class="male_span">男</span>
                    </div>
                    <div class="female_div">
                      <input type="checkbox" class="female" name="sexx"/>
                      <span class="female_span">女</span>
                    </div>
                    <div class="secret_div">
                      <input type="checkbox" class="secret" name="sexx"/>
                      <span class="secret_span">保密</span>
                    </div>
                  </div>  
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">电&emsp;&emsp;话<span class="ast">*</span>：</label>
                <div class="col-sm-10">
                  <input type="text" class="phone" placeholder="123456888897789">
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">邮&emsp;&emsp;箱<span style="color:#fff;">*</span>：</label>
                <div class="col-sm-10">
                  <input type="text" class="mail" placeholder="邮箱">
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" style="margin-top:8px;">个人签名<span style="color:#fff;">*</span>：</label>
                <div class="col-sm-10">
                  <textarea class="signature"></textarea>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" style="margin-top:8px;">个人简介<span style="color:#fff;">*</span>：</label>
                <div class="col-sm-10">
                  <textarea class="introduction"></textarea>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">出生日期<span style="color:#fff;">*</span>：</label>
                <div class="col-sm-10">
                  <div class="birthday_container" id="div_container">  
                    <div class="btn-group">
                      <a href="#" class="year date" data-toggle="dropdown">年<span class="caret"></span></a>
                      <ul class="dropdown-menu year_menu" role="menu"></ul>
                    </div>
                    <div class="btn-group">
                      <a href="#" class="month date" data-toggle="dropdown">月<span class="caret"></span></a>
                      <ul class="dropdown-menu month_menu" role="menu"></ul>
                    </div>
                    <div class="btn-group">
                      <a href="#" class="day date" data-toggle="dropdown">日<span class="caret"></span></a>
                      <ul class="dropdown-menu day_menu" role="menu"></ul>
                    </div>  
                  </div>  
                </div>
              </div>
              <div class="form-group">
                <input  class="saveSet" type="button" value="保存设置" />
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="right_content">
        <h3>我的头像：</h3>
        <div class="portrait">
          <img src="../anchorResource/img/a5.jpg" alt="" class="defaultImg"/>
        </div>
        <div class="mask_gif">
          <img src="../anchorResource/img/waiting_circle.gif" alt="图片上传等待" />
        </div>
        <input type="file" class="upl_img" style="display: none;" value="img/a5.jpg"/>
        <p class="txt_p1">文加大小≤1兆</p>
        <p class="txt_p2">支持JPG.PNG的文件格式</p>
        <div class="replace_portrait">替换头像</div>
      </div>
    </div>
  </div>
</body>
<script>
$(function(){
  $(".year_menu").on("click","li",function(){
    $(".year_menu li").removeClass("selected");
    $(this).addClass("selected");
    var txt=$(this).children("a").html();
    $(this).parent().siblings(".date").html(txt);
    var _this=$(this).parent().parent().parent();
    $.fn.birthday.change(_this);
  });
  $(".month_menu").on("click","li",function(){
    $(".month_menu li").removeClass("selected");
    $(this).addClass("selected");
    var txt=$(this).children("a").html();
    $(this).parent().siblings(".date").html(txt);
    var _this=$(this).parent().parent().parent();
    $.fn.birthday.change(_this);
  });
  $(".day_menu").on("click","li",function(){
    $(".day_menu li").removeClass("selected");
    $(this).addClass("selected");
    var txt=$(this).children("a").html();
    $(this).parent().siblings(".date").html(txt);
    var _this=$(this).parent().parent().parent();
    $.fn.birthday.change(_this);
  });

  $.fn.birthday = function(options){
    var opts = $.extend({}, $.fn.birthday.defaults, options);//整合参数  
    var $year = $(this).children(".btn-group").children(".year_menu");  
    var $month = $(this).children(".btn-group").children(".month_menu");  
    var $day = $(this).children(".btn-group").children(".day_menu");  
    MonHead = [31,28,31,30,31,30,31,31,30,31,30,31];  
    return this.each(function(){  
      var date = new Date();
      var nowYear = date.getFullYear();//获取当前的年
      var con="";
      for(var i=nowYear;i>=nowYear-100;i--){
        con+="<li><a href='javascript:void(0)' value="+i+">"+i+"年</a></li>";
      }
      $(".year_menu").append(con);
      con = "";
      for(var i=1;i<=12;i++){
        con+="<li><a href='javascript:void(0)' value="+i+">"+i+"月</a></li>";
      }
      $(".month_menu").append(con);
      con = "";
      var n = MonHead[0];//默认显示第一月  
      for(i = 1; i <= n; i++){  
        con+="<li><a href='javascript:void(0)' value="+i+">"+i+"日</a></li>";  
      }  
      $(".day_menu").append(con);
    });
  };
  $.fn.birthday.change = function(obj){ 
    var $year = obj.children(".btn-group").children(".year_menu");  
    var $month = obj.children(".btn-group").children(".month_menu");  
    var $day = obj.children(".btn-group").children(".day_menu");
    //$day.empty();  
    var selectedYear=$year.children(".selected").children("a").attr("value");  
    var selectedMonth=$month.children(".selected").children("a").attr("value");
    var selectedDay=$day.children(".selected").children("a").attr("value"); 
    if(selectedMonth == 2 && $.fn.birthday.IsRunYear(selectedYear)){//如果是闰年  
      var con ="";  
      for(var i = 1; i <= 29; i++){  
        con+="<li><a href='javascript:void(0)' value="+i+">"+i+"日</a></li>";   
      }  
      $day.append(con);  
    }else {//如果不是闰年也没选2月份  
      var con = "";  
      for(var i = 1; i <= MonHead[selectedMonth-1]; i++){  
        con+="<li><a href='javascript:void(0)' value="+i+">"+i+"日</a></li>";
      }  
      $day.append(con);  
    }   
  };  
  $.fn.birthday.IsRunYear = function(selectedYear){  
    return(((0 == selectedYear%4)&& (selectedYear%100!=0))||(selectedYear%400==0));  
  };  
  $.fn.birthday.defaults = {  
    year:"year",  
    month:"month",  
    day:"day"  
  };  
  $(".birthday_container").birthday();  
});
$(function(){
  var rootPath=getRootPath();
  
  var uid=$(".login_user span",parent.document).attr("userid");
  var deviceId="";
  var pcdType=3;
  
  var data1={};
  data1.IMEI=deviceId;
  data1.PCDType=pcdType;
  data1.UserId=uid;
  getUserInfo(data1);//得到个人资料数据
  function getUserInfo(data1){
    $.ajax({
      type:"POST",
      url:rootPath+"passport/user/getUserInfo.do",
      dataType:"json",
      data:JSON.stringify(data1),
      success: function(returnData){
        if(returnData.ReturnType=="1001"){
          fillPersonData(returnData);//填充个人数据
        }else{
          alert(returnData.Message);
        }
      },
      error:function(jqXHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  }
  //填充个人数据
  function fillPersonData(returnData){
    $(".nickname").val(returnData.UserInfo.NickName?returnData.UserInfo.NickName:"暂无"); 
    if(!returnData.UserInfo.Sex){//性别保密
      $("input[name='sexx']").removeAttr("checked");
      $(".secret").prop("checked",true);
    }else{
      $("input[name='sexx']").removeAttr("checked");
      if(returnData.UserInfo.Sex=="女") $(".female").prop("checked",false);
      else $(".male").prop("checked",false);
    }
    $(".phone").val(returnData.UserInfo.PhoneNum?returnData.UserInfo.PhoneNum:"保密");
    $(".mail").val(returnData.UserInfo.Mail?returnData.UserInfo.Mail:"保密");
    $(".signature").val(returnData.UserInfo.UserSign?returnData.UserInfo.UserSign:"暂无");
    $(".introduction").val(returnData.UserInfo.Descn?returnData.UserInfo.Descn:"暂无");
    if(returnData.UserInfo.Birthday){
      var dates=returnData.UserInfo.Birthday;
      formatDate(dates);//时间戳转换生日
    }
    if(returnData.UserInfo.PortraitBig){
      $(".portrait img").attr("src",returnData.UserInfo.PortraitBig);
    }
  }
  //时间戳转换生日
  function formatDate(now){
    var now = new Date(now);
    var year=now.getFullYear();     
    var month=now.getMonth()+1;     
    var day=now.getDate();     
    $(".year_menu li").each(function(){
      if(year==$(this).children("a").attr("value")){
        $(this).addClass("selected");
        var txt=$(this).children("a").html();
        $(this).parent().siblings(".date").html(txt);
        var _this=$(this).parent().parent().parent();
        $.fn.birthday.change(_this);
        return false;
      }
    });
    $(".month_menu li").each(function(){
      if(month==$(this).children("a").attr("value")){
        $(this).addClass("selected");
        var txt=$(this).children("a").html();
        $(this).parent().siblings(".date").html(txt);
        var _this=$(this).parent().parent().parent();
        $.fn.birthday.change(_this);
        return false;
      }
    });
    $(".day_menu li").each(function(){
      if(day==$(this).children("a").attr("value")){
        $(this).addClass("selected");
        var txt=$(this).children("a").html();
        $(this).parent().siblings(".date").html(txt);
        var _this=$(this).parent().parent().parent();
        $.fn.birthday.change(_this);
        return false;
      }
    });
  }     

  /*s--点击替换头像*/
  $(".replace_portrait").on("click",function(){
    $(".upl_img").click();
  });
  $(".upl_img").change(function(){
    var oMyForm = new FormData();
    oMyForm.append("ContentFile", $(this)[0].files[0]);
    oMyForm.append("DeviceId","3279A27149B24719991812E6ADBA5584");
    oMyForm.append("MobileClass","Chrome");
    oMyForm.append("PCDType","3");
    oMyForm.append("UserId","123");
    oMyForm.append("Purpose","1");
    oMyForm.append("SrcType","1");
    var filePath=$(this).val();
    var _this=$(this);
    requestUpload(_this,oMyForm);
  });
  function requestUpload(_this,oMyForm){
    $.ajax({
      url:rootPath+"common/uploadCM.do",
      type:"POST",
      data:oMyForm,
      cache: false,
      processData: false,
      contentType: false,
      dataType:"json",
      beforeSend: function(){
        $(".mask_gif").show();
      },
      //表单提交前进行验证
      success: function (resultData){
        if(resultData.Success==true){
          $(".upl_img").attr("value",resultData.FilePath);
          if($(".defaultImg").css("display")!="none"){
            $(".defaultImg").css({"display":"none"});
          }
          var newImg =$("<img class='newImg' src="+resultData.FilePath+" alt='front cover' />");
          if($(".portrait").children().length>1){
            $(".portrait img:last").replaceWith(newImg);
          }else{
            $(".portrait").append(newImg);
          }
          setTimeout(function(){
            $(".mask_gif").hide();
          },200);
        }else{
          alert(resultData.err);
        }
      },
      error: function(jqXHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  };
  /*e--点击替换头像*/
  
  /*s--点击保存设置*/
  $(".saveSet").on("click",function(){
    var data2={};
    data2.IMEI=deviceId;
    data2.PCDType=pcdType;
    data2.NickName=$.trim($(".nickname").val());
    $("input[name='sexx']").each(function(){//性别id--待定
      if($(this).prop("checked")){
        data2.SexDictId=$(this).attr("sexId");
        return;
      }
    });
    data2.PhoneNum=$.trim($(".phone").val());
    data2.MailAddr=$.trim($(".mail").val());
    data2.UserSign=$.trim($(".signature").val());
    data2.UserDescn=$.trim($(".introduction").val());//描述待定
    //生日转换时间戳
    var yeartxt,monthtxt,daytxt,timestr="";
    $(".year_menu li").each(function(){
      if($(this).hasClass("selected")){
        yeartxt=$(this).children("a").attr("value");
        return false;
      }
    });
    $(".month_menu li").each(function(){
      if($(this).hasClass("selected")){
        monthtxt=$(this).children("a").attr("value");
        return false;
      }
    });
    $(".day_menu li").each(function(){
      if($(this).hasClass("selected")){
        daytxt=$(this).children("a").attr("value");
        return false;
      }
    });
    timestr=new Date(yeartxt+"/"+monthtxt+"/"+daytxt).getTime();
    data2.Birthday=timestr;
    $.ajax({
      type:"POST",
      url:rootPath+"passport/user/updateUserInfo.do",
      dataType:"json",
      data:JSON.stringify(data2),
      success: function(returnData){
        if(returnData.ReturnType=="1001"){
          alert("个人资料修改成功");
          getUserInfo(data1);//得到个人资料数据
        }else{
          alert(returnData.Message);
        }
      },
      error:function(jqXHR){
        alert("发生错误" + jqXHR.status);
      }
    });
  });
  
  /*e--点击保存设置*/
  
});
</script>
</html>