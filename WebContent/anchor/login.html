<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>主播登录</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="我听，我享听">
  <meta name="description" content="我听，我享听">
  <link href="../resources/plugins/hplus/css/bootstrap.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/animate.min.css" rel="stylesheet">
  <link href="../resources/plugins/hplus/css/style.min.css" rel="stylesheet">
  <script src="../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
  <script src="../resources/js/mainPage.js"></script>
  <script src="../resources/js/context.utils.js"></script>
  <script src="../anchor/anchorResource/js/jquery.cookie.js"></script>
</head>
<style>
*{margin: 0;padding: 0;}
li{list-style: none;}
a,a:hover,a:link,a:focus,a:visited{text-decoration: none;}
::-webkit-scrollbar {height:12px;width:2px;background:#e7eaec; } 
::-webkit-scrollbar-thumb{height:12px;width:2px;background:#e7eaec;}
html,body{height:100%;overflow-x: auto;font-family: "微软雅黑";}
body{
  position: relative;
  overflow: hidden;
}
.wrapper{
  width:100%;
  height: auto;
  position: absolute;
  background-image:url("anchorResource/img/bg.jpg");
  background-size:100% 100%;
}
.header{
  width:100%;
  height:80px;
  background: #ffa634;
}
.header img{
  background-size:100% 100%;
}
.containers{
  width:450px;
  margin:85px auto;
  background: #fff;
}
.nav_tabs{
  padding: 20px 0px;
  text-align: center;
  font-size: 24px;
  color: #e0e0e0;
}
.navtab_link{
  width: 220px;
  display: inline-block;
  cursor: pointer;
}
.line{
  width: 1px;
  height: 24px;
  border: 1px solid #e0e0e0;
}
.active{
  color:#FFA634;
}
.con_tabs{
  width: calc(100% - 0px);
  padding: 0px 40px 20px;
}
.dis{
  display: none;
}
.login_error,.register_error{
  width: calc(100% - 55px);
  padding: 2px 10px 2px 11px;
  font-size: 12px;
  color: #323232;
  border: 1px solid #ffa634;
  overflow: hidden;
  position: relative;
  margin: 0px 0px 0px 55px;
}
.lei{
  float: left;
  width: 16px;
  height: 16px;
  color: #ffa634;
  font-weight: bolder;
}
.les,.res{
  float: left;
}
.div1,.div2,.div4,.div6,.div7{
  width:100%;
  height:40px;
  margin-top:15px;
  overflow: hidden;
}
.div1 span,.div2 span,.div6 span,.div7 span{
  width:50px;
  height:100%;
  color: #000;
  position: relative;
  float: left;
  line-height:40px;
  font-size:16px;
}
.div1 input,.div2 input,.div7 input{
  width:calc(100% - 55px);
  height:36px;
  padding:0px 7px;
  margin-left:5px;
  float: left;
  border:1px solid #dedede;
}
.div3{
  width:100%;
  height:20px;
  margin:15px 0px;
  cursor: pointer;
}
.div3 img{
  width: 20px;
  height: 20px;
  margin: 10px 5px 0px 55px;
  float: left;
}
.fg_pw{
  margin-left: 175px;
}
.div3 span,.div3 a{
  color:#000;
  line-height: 40px;
  float: left;
  display: inline-block;
}
.div3 span:hover,.div3 a:hover{
  color:#f60;
}
.login_btn,.register_btn{
  width: 100%;
  height: 40px;
  line-height: 40px;
  display: block;
  text-align: center;
  background:#ffa634;
  color:#fff;
  font-weight: bold;
  font-size: 16px;
  border: none;
  border-radius: 4px;
}
.div5{
  width: 100%;
  height: 50px;
  margin-top:25px;
  overflow: hidden;
}
.div5 .line1{
  width:60px;
  height:2px;
  margin-top:22px;
  background: #dedede;
  float: left;
}
.div5 img{
  width: 42px;
  height: 42px;
  float: left;
  background-size: 100% 100%;
  margin-left: 16px;
  margin-right: 22px;
}
form{
  margin-bottom: 25px;
}
.codeval{
  margin-left:5px;
  float: left;
  width:150px;
  height: 40px;
  padding:0px 7px;
  border: 1px solid #dedede;  
}
.ver_code{
  width:150px;
  height:40px;
  line-height:40px;
  background: #ffa634;
  color: #fff;
  border:none;
  display: inline-block;
  margin-left:13px;
  text-align: center;
  cursor: pointer;
  float: left;
}
</style>
<body>
  <div class="wrapper">
    <div class="header">
      <img src="anchorResource/img/logo1.png" alt="logo" />
    </div>
    <div class="containers">
      <div class="nav_tabs">
        <span class="navtab_link active">登录</span>
        <span class="line"></span>
        <span class="navtab_link">注册</span>
      </div>
      <div class="con_tabs">
        <div class="login_area con_tab">
          <div class="login_error dis">
            <span class="lei">!</span>
            <span class="les"></span>
          </div>
          <form id="login_form">
            <div class="div1">
              <span>账&nbsp;&nbsp;&nbsp;号</span>
              <input type="text" placeholder="请输入账号" />
            </div>
            <div class="div2">
              <span>密&nbsp;&nbsp;&nbsp;码</span>
              <input type="password" placeholder="请输入密码" />
            </div>
            <div class="div3">
              <img src="anchorResource/img/checkbox1.png" alt="" class="keep checkbox1" />
              <span>记住密码</span>
              <a class="fg_pw" href="#">忘记密码?</a>
            </div>
            <div class="div4">
              <input type="button" value="登  录" class="login_btn"/>
            </div>
            <div class="div5">
              <span class="line1"></span>
              <img class="wechat" src="anchorResource/img/wechat.jpg" alt="微信" />
              <img class="mblog" src="anchorResource/img/mblog.jpg" alt="微博" />
              <img class="qq" src="anchorResource/img/qq.jpg" alt="qq" />
              <span class="line1"></span>
            </div>
          </form>
        </div>
        <div class="register_area con_tab dis">
          <div class="register_error dis">
            <span class="lei">!</span>
            <span class="res"></span>
          </div>
          <form id="register_form">
            <div class="div1">
              <span>账&nbsp;&nbsp;&nbsp;号</span>
              <input type="text" placeholder="手机号" />
            </div>
            <div class="div2">
              <span>昵&nbsp;&nbsp;&nbsp;称</span>
              <input type="text" placeholder="中英文均可，最长9个字符" maxlength="9"/>
            </div>
            <div class="div6">
              <span>验证码</span>
              <input class="codeval" type="text" placeholder="验证码" />
              <input type="button" class="ver_code" value="获取验证码"/>
            </div>
            <div class="div7">
              <span>密&nbsp;&nbsp;&nbsp;码</span>
              <input type="password" placeholder="6~20位数字，字母和字符，字母不区分大小写" />
            </div>
            <div class="div4">
              <input type="button" value="注  册" class="register_btn"/>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</body>
<script>
$(function(){
  var rootPath=getRootPath();
  
  /*登录与注册的切换*/
  $(".navtab_link").on("click",function(){
    var index=$(this).index();
    $(this).addClass("active").siblings(".navtab_link").removeClass("active");
    $(".con_tabs .con_tab").eq($('.navtab_link').index(this)).removeClass("dis").siblings().addClass("dis");
    $("#register_form")[0].reset();
    $("#login_form")[0].reset();
    $(".login_error").addClass("dis").children(".les").text(" ");
    $(".register_error").addClass("dis").children(".res").text(" ");
  });
  
  /*s--登录*/
  var pcdType=3;
  
  //利用cookie实现记住用户名和密码
  if($.cookie("keep")=="true"){//cookie里记住密码为true
    var sMobile=$.cookie('username'); 
    var sPassword=$.cookie('password');
    //将获取的值填充入输入框中
    $("#login_form .div1 input").val(sMobile);
    $("#login_form .div2 input").val(sPassword);
    if(sMobile!=null&&sMobile!=''&&sPassword!=null&&sPassword!=''){//选中保存密码的复选框 
      $(".keep").removeClass("checkbox1").attr({"src":"anchorResource/img/checkbox2.png"});
    }
　}
  
  //点击勾选框,记住密码
  $(".keep").on("click",function(){
    if($(this).hasClass("checkbox1")){//未选中
      $(this).removeClass("checkbox1").attr({"src":"anchorResource/img/checkbox2.png"});
    }else{//已选中
      $(this).addClass("checkbox1").attr({"src":"anchorResource/img/checkbox1.png"});
    }
  });
  
  //点击登录
  $(".login_btn").on("click",function(){
    var sMobile=$.trim($("#login_form .div1 input").val());
    var sPassword=$.trim($("#login_form .div2 input").val());
    if(!sMobile){
      $(".login_error").children(".les").text("请输入账号");
      $(".login_error").removeClass("dis");
      $("#login_form .div1 input").val("").focus(); 
      return false; 
    }
    if(!sPassword){
      $(".login_error").children(".les").text("请输入密码");
      $(".login_error").removeClass("dis");
      $("#login_form .div2 input").val("").focus(); 
      return false; 
    }
    var login_data={};
    login_data.PCDType=pcdType;
    login_data.UserName=sMobile;
    login_data.Password=sPassword;
    $.ajax({
      type:"POST",
      url:rootPath+"passport/user/mlogin.do",
      dataType:"json",
      cache:true,
      data:JSON.stringify(login_data),
      beforeSend:function(){
        $(".login_btn").attr("disabled","disabled").css("background","#dedede");
      },
      success: function(returnData){
        if(returnData.ReturnType=="1001"){
          if($(".keep").hasClass("checkbox1")){//未选择记住密码
            $.cookie("keep","false",{ expire:-1});
            $.cookie("username","",{ expires:-1});
            $.cookie("password","",{ expires:-1});
          }else{//选择记住密码
            $.cookie("keep","true",{ expires:7}); //存储一个带7天期限的cookie
            $.cookie("username",sMobile,{ expires:7});
            $.cookie("password",sPassword,{ expires:7});
          }
          var logSuccessName=login_data.UserName;
          var logSuccessId=returnData.UserInfo.UserId;
          var logSuccessPwd=login_data.Password;
          $.cookie("logSuccessName",logSuccessName);
          $.cookie("logSuccessId",logSuccessId);
          $.cookie("logSuccessPwd",logSuccessPwd);
          window.location.href="./anchor_index.html";
          $(".login_error").children(".les").text(" ");
          $(".login_error").addClass("dis");
        }else{
          $(".login_error").children(".les").text("你输入的账号和密码不匹配,请重新输入");
          $(".login_error").removeClass("dis");
        }
        $(".login_btn").removeAttr("disabled").css("background","#ffa634");
      },
      error:function(jqXHR){
        alert("登录发生错误:" + jqXHR.status);
      }
    });
  });
  
  //点击忘记密码
  $(".fg_pw").on("click",function(){
    window.location.href="./personCenter/forgetPassword.html";
  });
  
  //第三方登录--微信登录
  $(".wechat").on("click",function(){
    alert("欢迎使用微信登录");
  });
  
  //第三方登录--微博登录
  $(".mblog").on("click",function(){
    alert("欢迎使用微博登录");
  });
  
  //第三方登录--qq登录
  $(".qq").on("click",function(){
    alert("欢迎使用qq登录");
  });
  /*e--登录*/
 
  /*s--注册*/
  var InterValObj; //timer变量，控制时间  
  var curCount=60;//当前剩余秒数  
  var clicknum=0;
  
  //点击发送验证码 
  $(".ver_code").on("click",function(){
    clicknum++;
    var sMobile=$.trim($("#register_form .div1 input").val());
    if(!sMobile){
      $(".register_error").children(".res").text("请输入手机号");
      $(".register_error").removeClass("dis");
      $("#register_form .div1 input").val("").focus(); 
      return false; 
    }else{
      var myreg=/^1[3|4|5|7|8][0-9]{9}$/;
      if(!(myreg.test(sMobile))){ 
        $(".register_error").children(".res").text("你输入的手机号不合法，请重新输入");
        $(".register_error").removeClass("dis");
        $("#register_form .div1 input").val("").focus(); 
        return false; 
      }else{
        if(clicknum>1){//点击起到的是重发效果
          var _url=rootPath+"passport/user/reSendPhoneCheckCode.do";
          var _data={};
          _data.PCDType=pcdType;
          _data.PhoneNum=sMobile;
          _data.OperType=1;
          getCode(_url,_data);//不是第一次得到验证码
        }else{//第一次发送验证码
          var _url=rootPath+"passport/user/registerByPhoneNum.do";
          var _data={};
          _data.PCDType=pcdType;
          _data.PhoneNum=sMobile;
          getCode(_url,_data);//第一次得到验证码
        }
      }
    }
  });
  
  //获取验证码
  function getCode(_url,_data){
    $.ajax({
      type:"POST",
      url:_url,
      dataType:"json",
      cache:true,
      data:JSON.stringify(_data),
      success:function(returnData){
        if(returnData.ReturnType=="1001"){
          InterValObj=window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
        }else{
          alert("获取验证码失败:"+returnData.Message);
        }
      },
      error:function(jqXHR){
        alert("获取验证码发生错误:" + jqXHR.status);
      }
    });
  }
  //计时器timer的时间处理
  function SetRemainTime(){  
    if(curCount==0){                  
      window.clearInterval(InterValObj);//停止计时器  
      $(".ver_code").removeAttr("disabled").val("重新发送验证码").css("background","#ffa634");//启用按钮  
      $(".codeval").val(" "); //清除验证码 
    }else{  
      curCount--;  
      $(".ver_code").val("请在" + curCount + "秒内输入验证码").attr("disabled", "true").css("background","#333");
    }  
  }
  
  //验证输入的验证码是否正确
  var checkcode=true;//默认输入的验证码是正确的
  function checkCode(sMobile,sCode){
    var _data={};
    _data.PCDType=pcdType;
    _data.PhoneNum=sMobile;
    _data.CheckCode=sCode;
    $.ajax({
      type:"POST",
      url:rootPath+"passport/user/checkPhoneCheckCode.do",
      dataType:"json",
      cache:true,
      async:false,
      data:JSON.stringify(_data),
      success:function(returnData){
        if(returnData.ReturnType!="1001"){
          $(".register_error").children(".res").text("你输入的验证码有误");
          $(".register_error").removeClass("dis");
          $("#register_form .codeval").val("").focus(); 
          checkcode=false;
          return false;
        }
      },
      error:function(jqXHR){
        alert("校验验证码发生错误" + jqXHR.status);
      }
    });
  }
  
  //点击注册
  $(".register_btn").on("click",function(){
    var sMobile=$.trim($("#register_form .div1 input").val());
    var sNick=$.trim($("#register_form .div2 input").val());
    var sCode=$.trim($("#register_form .codeval").val());
    var sPassword=$.trim($("#register_form .div7 input").val());
    if(!sMobile){
      $(".register_error").children(".res").text("请输入手机号");
      $(".register_error").removeClass("dis");
      $("#register_form .div1 input").val("").focus(); 
      return false; 
    }else{
      var myreg=/^1[3|4|5|7|8][0-9]{9}$/;
      if(!(myreg.test(sMobile))){ 
        $(".register_error").children(".res").text("你输入的手机号不合法，请重新输入");
        $(".register_error").removeClass("dis");
        $("#register_form .div1 input").val("").focus(); 
        return false; 
      } 
    }
    if(!sNick){
      $(".register_error").children(".res").text("请输入昵称");
      $(".register_error").removeClass("dis");
      $("#register_form .div2 input").val("").focus(); 
      return false; 
    }else{
      var myreg = /^[\u4e00-\u9fa5a-zA-Z0-9_]{1,9}$/;
      if(!(myreg.test(sNick))){ 
        $(".register_error").children(".res").text("你输入的昵称不合法，请重新输入");
        $(".register_error").removeClass("dis");
        $("#register_form .div2 input").val("").focus(); 
        return false; 
      } 
    }
    if(!sCode){
      $(".register_error").children(".res").text("请输入验证码");
      $(".register_error").removeClass("dis");
      $("#register_form .codeval").val("").focus(); 
      return false; 
    }else{
      var myreg = /\d{6}/;
      if((sCode.length!=6)||(!(myreg.test(sCode)))){ 
        $(".register_error").children(".res").text("验证码只能是6位的数字,请重新输入");
        $(".register_error").removeClass("dis");
        $("#register_form .codeval").val("").focus();
        return false; 
      }else{
        checkCode(sMobile,sCode);//验证输入的验证码是否正确
        //验证码输入不匹配
        if(checkcode==false) return false;
      }
    }
    if(!sPassword){
      $(".register_error").children(".res").text("请输入密码");
      $(".register_error").removeClass("dis");
      $("#register_form .div7 input").val("").focus(); 
      return false; 
    }else{
      var myreg = /(^[a-z]+$|^[A-Z]+$|^\d+$|^_+$)/;
      if((!(myreg.test(sPassword)))||sPassword.length<6||sPassword.length>20){ 
        $(".register_error").children(".res").text("你输入的密码不合法，请重新输入");
        $(".register_error").removeClass("dis");
        $("#register_form .div7 input").val("").focus(); 
        return false; 
      }
    }
    var register_data={};
    register_data.PCDType=pcdType;
    register_data.Password=sPassword;
    register_data.NickName=sNick;
    register_data.UsePhone=1;
    register_data.MainPhoneNum=sMobile;
    $.ajax({
      type:"POST",
      url:rootPath+"passport/user/register.do",
      dataType:"json",
      cache:true,
      data:JSON.stringify(register_data),
      beforeSend:function(){
        $(".register_btn").attr("disabled","disabled").css("background","#dedede");
      },
      success:function(returnData){
        if(returnData.ReturnType=="1001"){
          var logSuccessName=register_data.NickName;
          var logSuccessId=returnData.UserId;
          var logSuccessPwd=register_data.Password;
          $.cookie("logSuccessName",logSuccessName);
          $.cookie("logSuccessId",logSuccessId);
          $.cookie("logSuccessPwd",logSuccessPwd);
          window.location.href="./anchor_index.html";
          $(".register_error").children(".res").text(" ");
          $(".register_error").addClass("dis");
        }else{
          $(".register_error").children(".res").text("本账号已经存在,你不能再次注册");
          $(".register_error").removeClass("dis");
        }
        $(".register_btn").removeAttr("disabled").css("background","#ffa634");
      },
      error:function(jqXHR){
        alert("注册用户发生错误" + jqXHR.status);
      }
    });
  });
  /*e--注册*/
});
</script>
</html>
