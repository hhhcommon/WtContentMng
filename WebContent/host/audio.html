<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>声音管理</title>
<meta name="keywords" content="">
<meta name="description" content="">
<link href="../resources/plugins/hplus/css/bootstrap.min.css"
	rel="stylesheet">
<link href="../resources/plugins/hplus/css/font-awesome.min.css"
	rel="stylesheet">
<link href="../resources/plugins/hplus/css/animate.min.css"
	rel="stylesheet">
<link href="../resources/plugins/hplus/css/style.min.css"
	rel="stylesheet">
<link href="../resources/css/host.css" rel="stylesheet">
</head>
<body>
	<div class="" style="padding:0 25px;">
	  <!-- 操作和状态显示 -->
		<div class="commBox">
		  <p>共<span class="totalCount">0</span>个声音</p>
		  <button class="btn btn-warning">添加声音</button>
		</div>
		<!-- 列表显示区 -->
		<div class="actList"></div>
	</div>
	<!-- 全局js -->
	<script src="../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
	<script src="../resources/plugins/hplus/js/bootstrap.min.js"></script>
	<!-- 自定义js -->
	<script src="../resources/plugins/hplus/js/content.min(1).js"></script>

	<script src="../resources/js/context.utils.js"></script>
	<script src="../resources/js/host.js"></script>
	<!-- jQuery Validation plugin javascript-->
	<script src="../resources/plugins/hplus/js/plugins/validate/jquery.validate.min.js"></script>

	<script>
		$(function(){
			//获取列表
			dataParam={
          "UserId":userId,
          "url":rootPath+"content/media/getHostMediaList.do",
      };
			getContentList(dataParam);
			
			//点击添加节目按钮，弹出添加界面
      $(".btn").on("click",function(){
    	  $(window.top.document).find("#newIframe").attr({"src":"./host/add_audio.html"}).css({"display":"block"});
        $(window.top.document).find(".shade").css({"display":"block"});
      })
      
    //对专辑的改、删等4种操作
      $(".actList").on("click","i",function(){
   	    var parentDoc=$(window.top.document);
        switch($(this).attr("opeType")){
          case 'conUpdate':
            /*
            1，元素VALUE获取
            2，存取元素值，和提交时的对比
                                    获得另一个iframe的document对象   -》parent["newIframe"].document
            */
            parentDoc.find("#newIframe").attr({"src":"./host/update_audio.html"}).css({"display":"block"});
            parentDoc.find(".shade").css({"display":"block"});
            var _this=$(this).parents(".listBox");
            //这里可能是iframe里的页面还没渲染完成，如果不延时执行，获取里面的页面元素时将获取不到
            window.setTimeout(function(){
               var newIframe=$(parent["newIframe"].document);
               var contentId,contentName,contentDesc,contentImg,subjectWords;
               contentId=_this.attr("contentId");
               contentName=_this.attr("contentName");
               contentDesc=_this.attr("contentDesc");
               contentImg=_this.attr("contentImg");
               contentSeqId=_this.attr("contentSeqId");
               subjectWords=_this.attr("contentSubjectWords");
               var contentIdEle=$("<input id='ContentId' name='ContentId' class='form-control' type='hidden' value='' />");
               contentIdEle.val(contentId);
               newIframe.find("#updateMediaForm").append(contentIdEle);
               newIframe.find("#ContentName").val(contentName);
               newIframe.find("#ContentSeqId").val(contentSeqId);
               newIframe.find(".defaultImg").attr({"src":contentImg});
               newIframe.find("#ContentImg").val(contentImg);
               newIframe.find("#SubjectWords").val(subjectWords);
               newIframe.find("#ContentDesc").val(contentDesc);
            },100);
            break;
          case 'conShare':
            break;
          case 'conDel':
            dataParam={
              "UserId":userId,
              "ContentId":$(this).parents(".listBox").attr("contentId"),
              "url":rootPath+"content/media/removeMediaInfo.do",
              "opeType":$(this).attr("opeType"),
              "mediaType":"AUDIO"
           };
            getContentList(dataParam);
            break;
          case 'conPub':
        	  var contentSeqId=$(this).parents(".listBox").attr("contentSeqId");
        	  //单体发布时，如果没有专辑ID，则无法发布
        	  if(!contentSeqId){
        		  alert("该声音还未选择专辑！");
        		  return false;
        	  }
        	  dataParam={
              "UserId":userId,
              "ContentId":$(this).parents(".listBox").attr("contentId"),
              "url":rootPath+"content/media/updateMediaStatus.do",
              "opeType":$(this).attr("opeType"),
              "ContentSeqId":contentSeqId
            };
            getContentList(dataParam);
        	  break;
          default:
        }
      });
		});
	</script>
</body>
</html>