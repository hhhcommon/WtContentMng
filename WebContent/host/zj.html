<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>声音管理</title>
<meta name="keywords" content="">
<meta name="description" content="">
<link href="../resources/plugins/hplus/css/bootstrap.min.css" rel="stylesheet">
<link href="../resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
<link href="../resources/plugins/hplus/css/animate.min.css" rel="stylesheet">
<link href="../resources/plugins/hplus/css/style.min.css" rel="stylesheet">
<link href="../resources/css/host.css" rel="stylesheet">
</head>
<body>
  <div class="" style="padding:0 25px;">
    <!-- 操作和状态显示 -->
    <div class="commBox">
      <p>共<span class="totalCount">0</span>个专辑</p>
      <div class="input-group col-xs-4">
        <input type="text" placeholder="搜索" class="input-sm form-control"><span class="input-group-btn">
        <button type="button" class="btn btn-sm btn-warning">搜索</button></span>
      </div>
      <div class="btn-group roll-nav roll-right content-tabs" style='width:120px;left:470px;top:-155px;'>
        <button class="dropdown J_tabClose" data-toggle="dropdown" aria-expanded="false" style="width: 120px;" >请选择状态
        	<span class="caret"></span>
        </button>
        <ul role="menu" class="dropdown-menu dropdown-menu-right">
          <li class="J_tabShowActive"><a>已发布</a></li>
          <li class=""><a>已发布</a></li>
          <li class="J_tabCloseAll"><a>审核中</a></li>
          <li class="J_tabCloseOther"><a>未通过</a></li>
        </ul>
      </div>
      <button class="btn btn-warning create" style="position:relative;top:-160px;left:525px;">创建专辑</button>
    </div>
    <!-- 列表显示区 -->
    <div class="actList"></div>
  </div>
  <!-- 全局js -->
  <script src="../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
  <script src="../resources/plugins/hplus/js/bootstrap.min.js"></script>
  <!-- 自定义js -->
  <script src="../resources/plugins/hplus/js/content.min(1).js"></script>

  <script src="../resources/js/context.utils.js"></script>
  <script src="../resources/js/host.js"></script>
  <!-- jQuery Validation plugin javascript-->
  <script src="../resources/plugins/hplus/js/plugins/validate/jquery.validate.min.js"></script>
  <script>
    $(function(){
    	//获得父窗口window -> $(window.top) 或$(window.parent)  window可以省略
    	//获得父窗口document -> $(window.top.document)
    	//获取父窗口元素  ->$(window.top.document).find()
    	
      //获取列表
      dataParam={
    			"UserId":userId,
    			"url":rootPath+"content/seq/getHostSeqMediaList.do"
    	};
      getContentList(dataParam);
      
      //点击创建专辑按钮，弹出创建专辑界面
      $(".create").on("click",function(){
    	  $(window.top.document).find(".shade,#sequ").css({"display":"block"});
      })
      //对专辑的改、删等4种操作
      $(".actList").on("click","i",function(){
        switch($(this).attr("opeType")){
	        case 'conUpdate':
	        	//使用添加界面修改，对添加界面做相关调整
	        	/*
	        	1,界面文字修改
	        	2，元素VALUE获取
	        	3，存取元素值，和提交时的对比   (暂未实现)
	        	*/
	        	var listBox=$(this).parents(".listBox");
	        	var parentDoc=$(window.top.document);
	        	$(".create").trigger("click");
	        	parentDoc.find(".opeBox").attr({"opeType":"conUpdate"}).find("h5").text("修改专辑");
	        	var contentId,contentName,contentDesc,contentImg,subjectWords,catalogsId,channelsId;
	        	contentId=listBox.attr("contentId");
	        	contentName=listBox.attr("contentName");
	        	contentDesc=listBox.attr("contentDesc");
	        	contentImg=listBox.attr("contentImg");
	        	subjectWords=listBox.attr("contentSubjectWord");
	        	catalogsId=listBox.attr("contentCatalogsId");
	        	channelsId=listBox.attr("contentChannelsId");
	        	var contentIdEle=$("<input id='ContentId' name='ContentId' class='form-control' type='hidden' value='' />");
	        	contentIdEle.val(contentId);
	        	getCatalogs();
	        	parentDoc.find("#ContentCatalogsId").val(catalogsId);
	        	parentDoc.find("#ContentChannelsId").val(channelsId);
	        	parentDoc.find("form").append(contentIdEle);
	        	parentDoc.find("#ContentName").val(contentName);
	        	parentDoc.find(".defaultImg").attr({"src":contentImg});
	        	parentDoc.find("#ContentImg").val(contentImg);
	        	parentDoc.find("#SubjectWords").val(subjectWords);
	        	parentDoc.find("#ContentDesc").val(contentDesc);
	        	break;
        	case 'conShare':
        		break;
            case 'conDel':
        	    dataParam={
        		  "UserId":userId,
        		  "ContentId":$(this).parents(".listBox").attr("contentId"),
        		  "url":rootPath+"content/seq/removeSeqMediaInfo.do",
        		  "opeType":$(this).attr("opeType"),
        		  "mediaType":"SEQU"
        	    };
        	    getContentList(dataParam);
          	   break;
            case 'conPub':
                ContentId=$(this).parents(".listBox").attr("contentId");
                $.ajax({
          	      type:"POST",
          	      url:rootPath+"content/seq/getHostSeqMediaList.do",
                  dataType: "json",
                  data:{"UserId":userId,"ContentId":ContentId},
                  success: function(seqMediaList) { 
                    if(seqMediaList.ReturnType == "1001"){
            	     for(var i=0;i<seqMediaList.ResultList.AllCount;i++){
            		    if(ContentId==seqMediaList.ResultList.List[i].ContentId){    			 
                          ContentId=seqMediaList.ResultList.List[i].ContentId;
						  SubCount=seqMediaList.ResultList.List[i].SubCount;
            	          ContentChannelId=seqMediaList.ResultList.List[i].ContentPubChannels[0].ChannelId;
            	          $.ajax({
                            type : "POST",
                            url : rootPath+"content/seq/updateSeqMediaStatus.do",
                            dataType : "json",
                            data:{"UserId":userId,"ContentId":ContentId,"SubCount":SubCount,"ContentChannelId":ContentChannelId},
                            success: function(pubList){
                              if(pubList.ReturnType=="1001"){
              	                alert("专辑发布成功！");
                              }
                            },
                            error: function(jqXHR){
                              alert("发生错误" + jqXHR.status);
                            }
                         })
            	       }
                    }
                 }
               }
            })
            break;
          default:
        }
      });
    });
  </script>
</body>
</html>