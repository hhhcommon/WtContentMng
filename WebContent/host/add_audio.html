<!DOCTYPE html>
<!-- saved from url=(0066)http://www.sucaihuo.com/modals/3/328/demo/form_validate.html?v=3.0 -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<title>上传声音</title>
<meta name="keywords" content="">
<meta name="description" content="">

<link href="../resources/plugins/hplus/css/bootstrap.min.css" rel="stylesheet">
<link href="../resources/plugins/hplus/css/font-awesome.min.css" rel="stylesheet">
<link href="../resources/plugins/hplus/css/animate.min.css" rel="stylesheet">
<link href="../resources/plugins/hplus/css/style.min.css" rel="stylesheet">
<link href="../resources/css/host.css" rel="stylesheet">

</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content">
        <div class="row">
            <div class="col-sm-6  col-sm-offset-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>上传声音</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="http://www.sucaihuo.com/modals/3/328/demo/form_basic.html#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-user">
                                <li><a href="#">选项1</a>
                                </li>
                                <li><a href="#">选项2</a>
                                </li>
                            </ul>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <form class="form-horizontal m-t" id="addAudioForm" enctype="multipart/form-data">
                            <input id="UserId" name="UserId" class="form-control" type="hidden" value="123" />
                            <input id="MediaType" name="MediaType" class="form-control" type="hidden" value="wt_MediaAsset" />
                            <div class="form-group">
                                <label class="col-sm-3 control-label">声音名称：</label>
                                <div class="col-sm-8">
                                    <input id="ContentName" name="ContentName" class="form-control" type="text">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">选择文件：</label>
                                <div class="col-sm-8">
                                    <input id="uploadAudio" name="uploadAudio" class="form-control" type="file" form="uploadFile" />
                                    <input id="ContentFile" name="ContentFile" type="hidden" value=""  />
                                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i>文件最大5M，支持mp3、m4a格式</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">声音封面：</label>
                                <div class="col-sm-8">
                                    <div class="previewImg">
                                      <img class="defaultImg" src="../resources/images/constructing.jpg" alt="front cover" />
                                    </div>
                                    <input id="uploadImg" name="uploadImg" class="form-control" type="file" />
                                    <input id="ContentImg" name="ContentImg" type="hidden" value="" />
                                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i>文件最大1M，支持JPG、PNG格式</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">选择专辑：</label>
                                <div class="col-sm-8">
		                                <select class="form-control" name="ContentSequTitle">
								                        <option value="">默认</option>
								                        <option value="">后来</option>
								                        <option value="">Bingo</option>
								                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">声音标签：</label>
                                <div class="col-sm-8">
                                    <input id="SubjectWords" name="SubjectWords" class="form-control" type="text">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">声音描述：</label>
                                <div class="col-sm-8">
                                    <textarea id="ContentDesc" name="ContentDesc" class="form-control"></textarea>
                                </div>
                            </div>
                            <br /><br />
                            <div class="form-group">
                                <div class="col-sm-4 text-right">
                                    <button class="btn btn-primary" id="submitBtn">提交</button>
                                </div>
                                <div class="col-sm-4 text-center">
                                    <button class="btn btn-primary" type="publish">发布</button>
                                </div>
                                <div class="col-sm-4 text-left">
                                    <a class="close-link btn btn-primary">
				                                                                                            取消
				                            </a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 全局js -->
    <script src="../resources/plugins/hplus/js/jquery-2.1.1.min.js"></script>
    <script src="../resources/plugins/hplus/js/bootstrap.min.js"></script>
    <!-- 自定义js -->
    <script src="../resources/plugins/hplus/js/content.min(1).js"></script>
    <!-- jQuery Validation plugin javascript-->
    <script src="../resources/plugins/hplus/js/plugins/validate/jquery.validate.min.js"></script>
    
    <script src="../resources/plugins/hplus/js/plugins/form/jquery.form.js"></script>
    <!-- http://localhost:908/CM/index_wt.html -->
    <script>
        //表单验证默认设置
        $.validator.setDefaults({
          highlight:function(a){$(a).closest(".form-group").removeClass("has-success").addClass("has-error")},
          success:function(a){a.closest(".form-group").removeClass("has-error").addClass("has-success")},
          errorElement:"span",
          errorPlacement:function(a,b){if(b.is(":radio")||b.is(":checkbox")){a.appendTo(b.parent().parent().parent())}else{a.appendTo(b.parent())}},
          errorClass:"help-block m-b-none",
          validClass:"help-block m-b-none"
        });
        $().ready(function(){
        	  //表单验证
	          $("#addAudioForm").validate({
		            rules:{
		              ContentName:{required:true},
		              ContentFile:"required"
		            },
			          messages:{
			            ContentName:{required:"<i class='fa fa-times-circle'></i> "+"请输入您的声音名称"},
			            ContentFile:"<i class='fa fa-times-circle'></i> "+"您还没有选择声音文件哦"
			          }
	          });
        	  //封面图片预览与上传
        	  $("input[id='ContentImg']").change(function(){
        		     //图片预览
        		      if($(".defaultImg").css("display")!="none"){
        		    	  $(".defaultImg").css({"display":"none"});
        		      }
                  var fileReader = new FileReader();
                  fileReader.onload = function(evt)
                  {
                      if(FileReader.DONE==fileReader.readyState)
                      {    
                           var newImg =  $("<img alt='front cover' />");
                           newImg.attr({"src":this.result});//是Base64的data url数据
                           if($(".previewImg").children().length>1){
                        	   $(".previewImg img:last").replaceWith(newImg);
                           }else{
                        	   $(".previewImg").append(newImg);
                           }
                       }
                  }
                  fileReader.readAsDataURL($(this)[0].files[0]);
                  
                  //图片上传
                  var oMyForm = new FormData();
                  oMyForm.append("ContentFile", $(this)[0].files[0]);
                  $.ajax({
                      url:"http://localhost:908/CM/cmmon/uploadCM.do",
                      type:"POST",
                      data:oMyForm,
                      dataType:"json",
                      //表单提交前进行验证
                      
                      success: function (opeResult) {
                         if (opeResult.jsonType=="1") {
                           alert("上传成功");
                         }else{
                           alert(opeResult.err);
                         }
                      },
                      error: function(jqXHR){
                          alert("发生错误" + jqXHR.status);
                       }     
                  };
        	  });
        	  
        	//form表单提交
              $("#submitBtn").click(function () {
                 $.ajax({
                		  url:"http://localhost:908/CM/content/addMediaInfo.do",
                      type:"POST",
                      data:$("#addAudioForm").serialize(),
                      dataType:"json",
                      //表单提交前进行验证
                      
                      success: function (opeResult) {
                         if (opeResult.ReturnType=="1001") {
                           alert(opeResult.Message);
                         }else{
                           alert(opeResult.Message);
                         }
                      },
                      error: function(jqXHR){
                          alert("发生错误" + jqXHR.status);
                       }     
                  };
              });
	          
        });
    </script>
</body>
</html>